<!DOCTYPE html>
<html lang="fr">
<head>
    <%- include('includes/head') %>
    <title>NDRESSILIK - Tableau de Bord</title>
</head>

<body class="bg-gray-100">
    <%- include('includes/header') %>

    <main class="min-h-screen pt-20 pb-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Welcome Section -->
            <div class="mb-8">
                <div class="rounded-2xl bg-gray-900 overflow-hidden">
                    <div class="relative px-6 py-12 sm:px-12 sm:py-16">
                        <!-- Background Pattern -->
                        <div class="absolute inset-0 opacity-10 pointer-events-none">
                            <svg class="h-full w-full" viewBox="0 0 100 100">
                                <defs>
                                    <pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse">
                                        <path d="M 10 0 L 0 0 0 10" fill="none" stroke="white" stroke-width="0.5"/>
                                    </pattern>
                                </defs>
                                <rect width="100%" height="100%" fill="url(#grid)"/>
                            </svg>
                        </div>

                        <!-- Content -->
                        <div class="relative max-w-3xl">
                            <h1 class="text-3xl sm:text-4xl font-bold text-white mb-4">
                                Bienvenue, <%= user.firstName %>
                            </h1>
                            <p class="text-lg text-gray-300" id="#services">
                                Gérez vos services et optimisez votre visibilité sur notre plateforme.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Grid -->
            <div class="grid lg:grid-cols-3 gap-8">
                <!-- Left Column: Profile & Actions -->
                <div class="lg:col-span-2 space-y-8">
                    <!-- Profile Completion Alert -->
                    <% if (missingElements && missingElements.length > 0) { %>
                        <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                            <div class="p-6">
                                <div class="flex items-start gap-4">
                                    <div class="w-12 h-12 rounded-full bg-yellow-50 flex items-center justify-center flex-shrink-0">
                                        <i class="fas fa-user-edit text-yellow-600 text-xl"></i>
                                    </div>
                                    <div class="flex-1">
                                        <h3 class="text-lg font-semibold text-gray-900 mb-2">
                                            Complétez votre profil
                                        </h3>
                                        <p class="text-gray-600 mb-4">
                                            Il vous reste <%= missingElements.length %> éléments à compléter pour optimiser votre profil.
                                        </p>
                                        <button onclick="openMissingElementsModal()" 
                                                class="inline-flex items-center gap-2 px-4 py-2 rounded-lg
                                                       bg-gray-800 text-white hover:bg-gray-700 
                                                       transition-colors duration-200">
                                            <span>Voir les éléments</span>
                                            <i class="fas fa-arrow-right"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <% const totalElements = 5; %>
                            <!-- Progress Bar -->
                            <div class="h-2 bg-gray-100">
                                <div class="h-full bg-yellow-500 transition-all duration-500"
                                     style="width: <%= Math.round((1 - missingElements.length/totalElements) * 100) %>%">
                                </div>
                            </div>
                        </div>
                    <% } %>

                  <!-- Quick Actions -->
                  <div class=" px-4 sm:px-6 lg:px-8 py-8">
                    <!-- Main Container -->
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100">
                        <!-- Header Section -->
                        <div class="p-6 border-b border-gray-100">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <h2 class="text-2xl sm:text-3xl font-bold text-gray-900">Dashboard</h2>
                                    <div class="h-1.5 w-12 bg-blue-500 rounded-full"></div>
                                </div>
                                <!-- User Status -->
                                <div class="hidden sm:flex items-center space-x-2">
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-50 text-blue-700">
                                        <span class="w-2 h-2 bg-blue-500 rounded-full mr-2"></span>
                                        <%= user.role === 'breeder' ? 'Éleveur Certifié' : 'Membre' %>
                                    </span>
                                </div>
                            </div>
                        </div>
                
                        <!-- Breeder Section -->
                        <div class="p-6 space-y-6">
                            <% if (user.role === 'breeder') { %>
                                <a href="/dashboard/breedings" 
                                   class="block hover:bg-gray-50 rounded-xl p-6 transition-all duration-200 border border-transparent hover:border-gray-200">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-4">
                                            <div class="flex-shrink-0">
                                                <div class="w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center">
                                                    <i class="fas fa-paw text-blue-500 text-3xl"></i>
                                                </div>
                                            </div>
                                            <div class="space-y-1">
                                                <h3 class="text-xl font-medium text-gray-900">Gestion d'Élevage</h3>
                                                <p class="text-base text-gray-500">Gérer vos animaux et services</p>
                                                <div class="flex items-center space-x-4 mt-2">
                                                    <span class="inline-flex items-center text-sm text-gray-500">
                                                        <i class="fas fa-dog mr-1"></i>
                                                        <!-- < %= totalPets || 0 %> animaux -->
                                                    </span>
                                                    <span class="inline-flex items-center text-sm text-gray-500">
                                                        <i class="fas fa-calendar-check mr-1"></i>
                                                        <!-- < %= totalServices || 0 %> services -->
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                        </svg>
                                    </div>
                                </a>
                            <% } %>
                
                          
                
                            <!-- Quick Actions Grid -->
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                <!-- New Service Card -->
                                <a href="/dashboard/new-service" 
                                   class="group block p-6 bg-white rounded-xl border border-gray-100 hover:border-blue-500 transition-all duration-200">
                                    <div class="flex items-center space-x-4">
                                        <div class="w-16 h-16 bg-gray-900 rounded-full flex items-center justify-center group-hover:bg-blue-500 transition-colors duration-200">
                                            <i class="fas fa-plus text-white text-2xl"></i>
                                        </div>
                                        <div class="space-y-2">
                                            <h3 class="text-xl font-medium text-gray-900">Nouveau service</h3>
                                            <p class="text-base text-gray-500">Créer et publier vos services</p>
                                            <div class="flex items-center text-sm text-blue-500 group-hover:text-blue-600">
                                                <span>Commencer</span>
                                                <i class="fas fa-arrow-right ml-2 transform group-hover:translate-x-1 transition-transform"></i>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                
                                <!-- Profile Card -->
                                <a href="/dashboard/profile" 
                                   class="group block p-6 bg-white rounded-xl border border-gray-100 hover:border-blue-500 transition-all duration-200">
                                    <div class="flex items-center space-x-4">
                                        <div class="w-16 h-16 bg-gray-900 rounded-full flex items-center justify-center group-hover:bg-blue-500 transition-colors duration-200">
                                            <i class="fas fa-user-edit text-white text-2xl"></i>
                                        </div>
                                        <div class="space-y-2">
                                            <h3 class="text-xl font-medium text-gray-900">Profil</h3>
                                            <% if (missingElements && missingElements.length > 0) { %>
                                                <div class="flex items-center space-x-2">
                                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-50 text-yellow-800">
                                                        <%= missingElements.length %> à compléter
                                                    </span>
                                                </div>
                                                <p class="text-base text-gray-500">Complétez votre profil pour plus de visibilité</p>
                                            <% } else { %>
                                                <p class="text-base text-gray-500">Gérez vos informations personnelles</p>
                                            <% } %>
                                            <div class="flex items-center text-sm text-blue-500 group-hover:text-blue-600">
                                                <span>Modifier</span>
                                                <i class="fas fa-arrow-right ml-2 transform group-hover:translate-x-1 transition-transform"></i>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                                
                            </div>
                            <% if (user.role !== 'breeder') { %>
                                <div class="border border-gray-100 rounded-xl p-8 bg-white">
                                    <div class="flex items-center space-x-4 mb-6">
                                        <div class="w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center">
                                            <i class="fas fa-star text-blue-500 text-3xl"></i>
                                        </div>
                                        <div>
                                            <h3 class="text-2xl font-semibold text-gray-900">Devenez Éleveur</h3>
                                            <p class="text-gray-500 mt-1">Rejoignez notre communauté d'éleveurs certifiés</p>
                                        </div>
                                    </div>
                
                                    <div class="grid sm:grid-cols-2 gap-6 mb-8">
                                        <div class="space-y-4">
                                            <h4 class="text-lg font-medium text-gray-900">Avantages</h4>
                                            <ul class="space-y-4">
                                                <li class="flex items-center text-lg text-gray-600">
                                                    <div class="w-1.5 h-1.5 bg-blue-500 rounded-full mr-3"></div>
                                                    <span>Gérer votre élevage professionnellement</span>
                                                </li>
                                                <li class="flex items-center text-lg text-gray-600">
                                                    <div class="w-1.5 h-1.5 bg-blue-500 rounded-full mr-3"></div>
                                                    <span>Ajouter et suivre vos chiens</span>
                                                </li>
                                                <li class="flex items-center text-lg text-gray-600">
                                                    <div class="w-1.5 h-1.5 bg-blue-500 rounded-full mr-3"></div>
                                                    <span>Partager votre expertise</span>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="space-y-4">
                                            <h4 class="text-lg font-medium text-gray-900">Fonctionnalités</h4>
                                            <ul class="space-y-4">
                                                <li class="flex items-center text-lg text-gray-600">
                                                    <div class="w-1.5 h-1.5 bg-green-500 rounded-full mr-3"></div>
                                                    <span>Gestion des pedigrees</span>
                                                </li>
                                                <li class="flex items-center text-lg text-gray-600">
                                                    <div class="w-1.5 h-1.5 bg-green-500 rounded-full mr-3"></div>
                                                    <span>Suivi des vaccinations</span>
                                                </li>
                                                <li class="flex items-center text-lg text-gray-600">
                                                    <div class="w-1.5 h-1.5 bg-green-500 rounded-full mr-3"></div>
                                                    <span>Calendrier des événements</span>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                
                                    <button id="become-breeder-btn" 
                                            class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium px-8 py-4 rounded-full transition-colors duration-200 flex items-center justify-center text-lg">
                                        <span>Devenir Éleveur</span>
                                        <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                        </svg>
                                    </button>
                                </div>
                            <% } %>
                        </div>
                    </div>
                </div>
                
                <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
                <script>
                $(document).ready(function() {
                    $('#become-breeder-btn').click(function() {
                        const button = $(this);
                        button.prop('disabled', true)
                              .html('<i class="fas fa-spinner fa-spin mr-2"></i> Traitement en cours...');
                        
                        $.ajax({
                            url: '/dashboard/change-role/breeder',
                            method: 'POST',
                            success: function(response) {
                                window.location.reload();
                            },
                            error: function(error) {
                                button.prop('disabled', false)
                                      .html('Devenir Éleveur <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>');
                                alert('Une erreur est survenue. Veuillez réessayer plus tard.');
                            }
                        });
                    });
                });
                </script>

                    <!-- Services List -->
                    <%- include('includes/services') %>
                </div>

                <!-- Right Column: Stats & Info -->
                <div class="space-y-8">
                    <!-- Profile Stats -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden p-6">
                        <h2 class="text-xl font-semibold text-gray-900 mb-6">Statistiques</h2>
                        <div class="space-y-4">
                            <!-- Views -->
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-lg bg-blue-50 flex items-center justify-center">
                                        <i class="fas fa-eye text-blue-500"></i>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600">Vues totales (Les Services)</div>
                                        <div class="text-lg font-semibold text-gray-900">
                                            <%= totalViews || 0 %>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Services Count -->
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-lg bg-green-50 flex items-center justify-center">
                                        <i class="fas fa-briefcase text-green-500"></i>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600">Services actifs</div>
                                        <div class="text-lg font-semibold text-gray-900">
                                            <%= services.length %> service<%= services.length > 1 ? 's' : '' %>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tips Card -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden p-6">
                        <h2 class="text-xl font-semibold text-gray-900 mb-4">Conseils</h2>
                        <ul class="space-y-3">
                            <li class="flex items-start gap-3">
                                <i class="fas fa-check-circle text-green-500 mt-1"></i>
                                <p class="text-sm text-gray-600">Ajoutez des photos de qualité à vos services</p>
                            </li>
                            <li class="flex items-start gap-3">
                                <i class="fas fa-check-circle text-green-500 mt-1"></i>
                                <p class="text-sm text-gray-600">Détaillez vos descriptions de services</p>
                            </li>
                            <li class="flex items-start gap-3">
                                <i class="fas fa-check-circle text-green-500 mt-1"></i>
                                <p class="text-sm text-gray-600">Répondez rapidement aux messages</p>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Missing Elements Modal Components -->
<!-- Modal Backdrop -->
<div id="modalBackdrop" 
class="fixed inset-0 bg-black/50 opacity-0 pointer-events-none transition-opacity duration-300" 
onclick="closeMissingElementsModal()">
</div>

<!-- Modal -->
<div id="missingElementsModal" class="fixed inset-0 z-50 flex items-center justify-center pointer-events-none">
<div class="w-full max-w-lg transform translate-y-8 opacity-0 pointer-events-none transition duration-300">
   <div class="relative bg-white rounded-xl shadow-xl mx-4">
       <!-- Modal Header -->
       <div class="flex items-center justify-between p-6 border-b">
           <div class="flex items-center gap-3">
               <div class="w-10 h-10 rounded-lg bg-yellow-50 flex items-center justify-center">
                   <i class="fas fa-exclamation-circle text-yellow-600 text-xl"></i>
               </div>
               <h3 class="text-xl font-semibold text-gray-900">
                   Améliorations recommandées
               </h3>
           </div>
           <button onclick="closeMissingElementsModal()" 
                   class="text-gray-400 hover:text-gray-600 p-2 rounded-lg transition-colors">
               <i class="fas fa-times text-xl"></i>
           </button>
       </div>

       <!-- Modal Content -->
       <div class="p-6 space-y-6 max-h-[60vh] overflow-y-auto">
           <p class="text-gray-600">
               Complétez ces éléments pour optimiser votre profil et augmenter votre visibilité :
           </p>
           <div class="space-y-4">
               <% missingElements.forEach((element, index) => { %>
                   <div class="flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                       <div class="w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center flex-shrink-0">
                           <span class="text-sm font-medium text-yellow-800">
                               <%= index + 1 %>
                           </span>
                       </div>
                       <div class="flex-1">
                           <p class="font-medium text-gray-900 mb-2">
                               <%= element.label %>
                           </p>
                           <a href="<%= element.link %>" 
                              class="inline-flex items-center text-sm text-gray-800 hover:text-gray-600 
                                     font-medium group">
                               <span>Compléter maintenant</span>
                               <i class="fas fa-arrow-right ml-2 text-xs transition-transform 
                                        group-hover:translate-x-1"></i>
                           </a>
                       </div>
                   </div>
               <% }); %>
           </div>
       </div>

       <!-- Modal Footer -->
       <div class="border-t p-6">
           <button onclick="closeMissingElementsModal()" 
                   class="w-full bg-gray-800 hover:bg-gray-700 text-white font-medium
                          py-3 px-4 rounded-lg transition-colors">
               Fermer
           </button>
       </div>
   </div>
</div>
</div>

<!-- Modal Scripts -->
<script>
function openMissingElementsModal() {
   const modal = document.getElementById('missingElementsModal');
   const modalContent = modal.querySelector('.transform');
   const backdrop = document.getElementById('modalBackdrop');

   // Enable pointer events
   modal.classList.remove('pointer-events-none');
   modalContent.classList.remove('pointer-events-none');
   backdrop.classList.remove('pointer-events-none');

   // Show backdrop
   backdrop.classList.remove('opacity-0');

   // Animate modal
   requestAnimationFrame(() => {
       modalContent.classList.remove('translate-y-8', 'opacity-0');
   });

   // Prevent body scroll
   document.body.style.overflow = 'hidden';
}

function closeMissingElementsModal() {
   const modal = document.getElementById('missingElementsModal');
   const modalContent = modal.querySelector('.transform');
   const backdrop = document.getElementById('modalBackdrop');

   // Animate out
   modalContent.classList.add('translate-y-8', 'opacity-0');
   backdrop.classList.add('opacity-0');

   // Disable pointer events after animation
   setTimeout(() => {
       modal.classList.add('pointer-events-none');
       modalContent.classList.add('pointer-events-none');
       backdrop.classList.add('pointer-events-none');

       // Restore body scroll
       document.body.style.overflow = '';
   }, 300);
}

// Close modal on escape key
document.addEventListener('keydown', (e) => {
   if (e.key === 'Escape') {
       closeMissingElementsModal();
   }
});

// Close modal on backdrop click
document.getElementById('modalBackdrop').addEventListener('click', (e) => {
   if (e.target === e.currentTarget) {
       closeMissingElementsModal();
   }
});
</script>
    <%- include('includes/scripts') %>
</body>
</html>