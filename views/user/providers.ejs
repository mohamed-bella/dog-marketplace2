<%- include('include/head.ejs') %>
     <%- include('include/navbar.ejs') %>

          <div class="bg-gray-50 min-h-screen lg:pt-20 pt-16">
               <!-- Quick Filter Bar -->
               <div class="sticky top-16 z-20 bg-white border-b border-gray-100 shadow-sm">
                    <div class="max-w-7xl mx-auto px-4">
                         <div class="flex overflow-x-auto no-scrollbar py-3 gap-3">
                              <!-- Total Count -->
                              <div class="flex items-center px-4 py-1.5 bg-orange-50 text-orange-700 rounded-full text-sm font-medium">
                                   <%= totalProviders %> prestataire<%= totalProviders> 1 ? 's' : '' %>
                              </div>

                              <!-- Quick Filters -->
                              <select name="location" class="px-4 py-1.5 bg-gray-50 rounded-full text-sm font-medium border border-gray-200 focus:ring-0 hover:border-gray-300 cursor-pointer" onchange="applyFilter('location', this.value)">
                                   <option value="">üìç Ville</option>
                                   <% locations.forEach(location=> { %>
                                        <option value="<%= location %>" <%=filters.location===location ? 'selected' : '' %>>
                                             <%= location.charAt(0).toUpperCase() + location.slice(1) %>
                                        </option>
                                        <% }) %>
                              </select>

                              <select name="specialization" class="px-4 py-1.5 bg-gray-50 rounded-full text-sm font-medium border border-gray-200 focus:ring-0 hover:border-gray-300 cursor-pointer" onchange="applyFilter('specialization', this.value)">
                                   <option value="">üéØ Sp√©cialisation</option>
                                   <% specializations.forEach(spec=> { %>
                                        <option value="<%= spec %>" <%=filters.specialization===spec ? 'selected' : '' %>>
                                             <%= spec.split('-').map(word=> word.charAt(0).toUpperCase() + word.slice(1)).join(' ') %>
                                        </option>
                                        <% }) %>
                              </select>




                         </div>
                    </div>
               </div>

               <!-- Main Content -->
               <div class="max-w-7xl mx-auto px-4 py-6">
                    <!-- Providers Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                         <% providers.forEach(provider=> { %>
                              <div class="bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow overflow-hidden group">
                                   <!-- Provider Header -->
                                   <div class="relative h-32 overflow-hidden">
                                        <img src="<%= provider.coverImage %>" alt="<%= provider.displayName %>" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
                                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>

                                        <!-- Profile Image -->
                                        <div class="absolute bottom-3 left-3 flex items-center gap-3">
                                             <div class="relative">
                                                  <img src="<%= provider.profileImage %>" alt="<%= provider.displayName %>" class="w-14 h-14 rounded-xl border-2 border-white object-cover">
                                                  <% if (provider.isVerified) { %>
                                                       <div class="absolute -top-1 -right-1 bg-blue-500 text-white p-1 rounded-full">
                                                            <i class="fas fa-check text-[10px]"></i>
                                                       </div>
                                                       <% } %>
                                             </div>
                                             <div class="text-white">
                                                  <h3 class="font-semibold leading-tight">
                                                       <%= provider.displayName %>
                                                  </h3>
                                                  <p class="text-sm text-white/90 flex items-center gap-1">
                                                       <i class="fas fa-map-marker-alt text-xs"></i>
                                                       <%= provider.location?.city %>
                                                  </p>
                                             </div>
                                        </div>
                                   </div>

                                   <!-- Provider Info -->
                                   <div class="p-4">
                                        <!-- Specializations -->
                                        <div class="flex flex-wrap gap-1 mb-4">
                                             <% provider.specializations.slice(0, 2).forEach(spec=> { %>
                                                  <span class="px-2 py-0.5 bg-orange-50 text-orange-700 rounded-full text-xs font-medium">
                                                       <%= spec.split('-').map(word=> word.charAt(0).toUpperCase() + word.slice(1)).join(' ') %>
                                                  </span>
                                                  <% }) %>
                                                       <% if (provider.specializations.length> 2) { %>
                                                            <span class="px-2 py-0.5 bg-gray-50 text-gray-600 rounded-full text-xs font-medium">
                                                                 +<%= provider.specializations.length - 2 %>
                                                            </span>
                                                            <% } %>
                                        </div>



                                        <!-- Action Button -->
                                        <a href="/@<%= provider.slug %>" class="mt-4 w-full flex items-center justify-center gap-2 px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors">
                                             Voir le profil
                                             <i class="fas fa-arrow-right text-xs"></i>
                                        </a>
                                   </div>
                              </div>
                              <% }) %>
                    </div>

                    <!-- Pagination -->
                    <% if (totalPages> 1) { %>
                         <div class="flex justify-center mt-8 gap-2">
                              <% for (let i=1; i <=totalPages; i++) { %>
                                   <a href="?page=<%= i %>&<%= new URLSearchParams({...filters, page: undefined}).toString() %>" class="w-10 h-10 flex items-center justify-center rounded-lg text-sm font-medium
                              <%= currentPage === i ? 'bg-orange-500 text-white' : 'bg-white text-gray-700 hover:bg-gray-50' %>">
                                        <%= i %>
                                   </a>
                                   <% } %>
                         </div>
                         <% } %>
               </div>
          </div>

          <script>
               // Filter functionality
               function applyFilter(type, value) {
                    const params = new URLSearchParams(window.location.search);

                    if (value) {
                         params.set(type, value);
                    } else {
                         params.delete(type);
                    }

                    // Reset to first page when filtering
                    params.delete('page');

                    window.location.href = `${window.location.pathname}?${params.toString()}`;
               }

               // Prevent horizontal scroll from propagating
               document.querySelector('.no-scrollbar').addEventListener('wheel', (e) => {
                    if (e.deltaY == 0) e.preventDefault();
               });
          </script>

          <style>
               /* Hide scrollbar */
               .no-scrollbar::-webkit-scrollbar {
                    display: none;
               }

               .no-scrollbar {
                    -ms-overflow-style: none;
                    scrollbar-width: none;
               }

               /* Smooth transitions */
               .transition-all {
                    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
               }
          </style>

          <%- include('include/footer.ejs') %>