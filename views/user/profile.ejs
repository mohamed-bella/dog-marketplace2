<%- include('include/head') %>
     <%- include('include/navbar') %>

          <div class="bg-white">
               <!-- Stats and Quick Access Section -->
               <div class="min-h-screen bg-gray-50">
                    <!-- Mobile Header -->


                    <!-- Main Content -->
                    <div class="max-w-2xl mx-auto px-4 py-6">
                         <!-- Profile Card -->
                         <div class="bg-white rounded-2xl p-6 shadow-sm">
                              <div class="flex flex-col items-center px-4 py-6 sm:py-8">
                                   <!-- Profile Image & Verification Badge -->
                                   <div class="relative">
                                        <!-- Image Container -->
                                        <div class="relative group">
                                             <div class="rounded-full p-1 bg-gradient-to-r from-blue-600 to-blue-400">
                                                  <div class="w-20 h-20 sm:w-24 sm:h-24 rounded-full overflow-hidden ring-4 ring-white">
                                                       <img src="<%= user.profileImage %>" alt="<%= user.displayName %>" class="w-full h-full object-cover" loading="lazy">
                                                  </div>
                                             </div>

                                             <% if (user.isVerified) { %>
                                                  <div class="absolute -right-1 -bottom-1">
                                                       <div class="flex items-center justify-center w-6 h-6 rounded-full bg-white shadow-sm">
                                                            <svg class="w-4 h-4 text-blue-500" viewBox="0 0 24 24" fill="currentColor">
                                                                 <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z" />
                                                            </svg>
                                                       </div>
                                                  </div>
                                                  <% } %>
                                        </div>
                                   </div>

                                   <!-- Profile Info -->
                                   <div class="mt-4 text-center">
                                        <h1 class="text-xl font-semibold text-gray-900 sm:text-2xl">
                                             <%= user.displayName %>
                                        </h1>

                                        <div class="mt-2 inline-flex items-center rounded-full px-2.5 py-0.5 text-xs sm:text-sm font-medium bg-gradient-to-r from-blue-500/10 to-blue-600/10 text-blue-600">
                                             <%= user.role==='provider' ? 'Prestataire de service' : 'Client' %>
                                        </div>
                                   </div>

                                   <% if (user.badges && user.badges.length> 0) { %>
                                        <!-- Primary Badge -->
                                        <div class="mt-6">
                                             <div class="inline-flex flex-col items-center">
                                                  <div class="relative">
                                                       <!-- Badge Icon with Glow Effect -->
                                                       <div class="p-3 rounded-xl bg-gradient-to-r from-amber-500/10 to-amber-600/10">
                                                            <img src="<%= user.badges[0].icon %>" alt="<%= user.badges[0].label %>" class="w-10 h-10 sm:w-12 sm:h-12">
                                                       </div>
                                                       <!-- Active Status Indicator -->
                                                       <div class="absolute -bottom-1 -right-1 h-4 w-4 rounded-full border-2 border-white bg-green-500"></div>
                                                  </div>

                                                  <span class="mt-2 inline-flex items-center gap-1 rounded-full bg-amber-50 px-2 py-1 text-xs font-medium text-amber-700 ring-1 ring-inset ring-amber-600/20">
                                                       <%= user.badges[0].label %>
                                                  </span>
                                             </div>
                                        </div>

                                        <!-- Badge Grid -->
                                        <div class="mt-6 flex flex-wrap justify-center gap-2">
                                             <% user.badges.slice(1).forEach(badge=> { %>
                                                  <div class="group relative">
                                                       <!-- Badge Button -->
                                                       <button class="inline-flex items-center gap-1.5 rounded-lg px-2.5 py-1.5 text-xs font-medium
                                                 bg-gray-50 text-gray-700 hover:bg-gray-100 
                                                 transition duration-150 ease-in-out">
                                                            <img src="<%= badge.icon %>" alt="" class="w-4 h-4 transition-transform group-hover:scale-110">
                                                            <%= badge.label %>
                                                       </button>

                                                       <!-- Tooltip -->
                                                       <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 
                                                 rounded-lg bg-gray-900 text-xs 
                                                 invisible opacity-0 group-hover:visible group-hover:opacity-100 
                                                 transition-all duration-200 z-10">
                                                            <!-- Content -->
                                                            <div class="text-white space-y-1">
                                                                 <p class="font-medium">
                                                                      <%= badge.description %>
                                                                 </p>
                                                                 <p class="text-gray-400">Obtenu le <%= badge.earnedAt %>
                                                                 </p>
                                                            </div>

                                                            <!-- Arrow -->
                                                            <div class="absolute -bottom-1 left-1/2 -translate-x-1/2 
                                                     border-4 border-transparent border-t-gray-900"></div>
                                                       </div>
                                                  </div>
                                                  <% }) %>
                                        </div>
                                        <% } %>
                              </div>

                              <style>
                                   /* Smooth animations */
                                   .transition {
                                        transition-property: all;
                                        transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
                                        transition-duration: 150ms;
                                   }

                                   /* Profile image hover effect */
                                   .group:hover img {
                                        transform: scale(1.05);
                                        transition: transform 0.2s ease-in-out;
                                   }

                                   /* Tooltip animation */
                                   .group:hover .invisible {
                                        transition-delay: 100ms;
                                   }

                                   /* Better image loading */
                                   img {
                                        backface-visibility: hidden;
                                        transform: translateZ(0);
                                   }

                                   /* Reduce motion if preferred */
                                   @media (prefers-reduced-motion: reduce) {

                                        .transition,
                                        .group:hover img {
                                             transition: none !important;
                                        }
                                   }

                                   /* Optimize for touch devices */
                                   @media (hover: none) {
                                        .group:hover img {
                                             transform: none;
                                        }
                                   }
                              </style>

                              <div class="grid grid-cols-2 gap-3 sm:grid-cols-4 sm:gap-4">
                                   <!-- Rating Stat -->
                                   <div class="group relative isolate overflow-hidden rounded-2xl bg-white p-4 shadow-sm ring-1 ring-gray-900/5 hover:shadow-md transition-all duration-300">
                                        <!-- Background Pattern -->
                                        <div class="absolute inset-0 -z-10 bg-[linear-gradient(45deg,var(--tw-gradient-from)_0%,var(--tw-gradient-to)_100%)] from-yellow-50 to-yellow-100/50 opacity-0 transition-opacity duration-300 group-hover:opacity-100"></div>

                                        <div class="flex flex-col h-full">
                                             <div class="flex items-start justify-between mb-1">
                                                  <!-- Score -->
                                                  <div class="flex items-baseline gap-1">
                                                       <span class="text-2xl font-bold tracking-tight text-gray-900">
                                                            <%= user.metrics?.averageRating?.toFixed(1) || '0.0' %>
                                                       </span>
                                                       <span class="text-sm text-gray-500">/5.0</span>
                                                  </div>

                                                  <!-- Stars -->
                                                  <div class="flex -space-x-1">
                                                       <% const rating=user.metrics?.averageRating || 0; Array(5).fill().forEach((_, i)=> { %>
                                                            <div class="w-4 h-4 rounded-full flex items-center justify-center
                                                          <%= i < rating ? 'text-yellow-400' : 'text-gray-200' %>
                                                          transition-colors duration-300">
                                                                 <svg class="w-4 h-4" viewBox="0 0 20 20" fill="currentColor">
                                                                      <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                                                                 </svg>
                                                            </div>
                                                            <% }); %>
                                                  </div>
                                             </div>

                                             <p class="text-sm font-medium text-gray-600">Note moyenne</p>
                                        </div>
                                   </div>

                                   <!-- Services Stat -->
                                   <div class="group relative isolate overflow-hidden rounded-2xl bg-white p-4 shadow-sm ring-1 ring-gray-900/5 hover:shadow-md transition-all duration-300">
                                        <!-- Background Pattern -->
                                        <div class="absolute inset-0 -z-10 bg-[linear-gradient(45deg,var(--tw-gradient-from)_0%,var(--tw-gradient-to)_100%)] from-blue-50 to-blue-100/50 opacity-0 transition-opacity duration-300 group-hover:opacity-100"></div>

                                        <div class="flex flex-col h-full">
                                             <div class="flex items-start justify-between mb-1">
                                                  <span class="text-2xl font-bold tracking-tight text-gray-900">
                                                       <%= user.metrics?.totalServices || 0 %>
                                                  </span>
                                                  <div class="flex h-8 w-8 items-center justify-center rounded-full bg-blue-100/80 text-blue-600 ring-1 ring-inset ring-blue-500/20">
                                                       <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                                       </svg>
                                                  </div>
                                             </div>

                                             <p class="text-sm font-medium text-gray-600">Services</p>
                                        </div>
                                   </div>

                                   <!-- Reviews Stat -->
                                   <div class="group relative isolate overflow-hidden rounded-2xl bg-white p-4 shadow-sm ring-1 ring-gray-900/5 hover:shadow-md transition-all duration-300">
                                        <!-- Background Pattern -->
                                        <div class="absolute inset-0 -z-10 bg-[linear-gradient(45deg,var(--tw-gradient-from)_0%,var(--tw-gradient-to)_100%)] from-purple-50 to-purple-100/50 opacity-0 transition-opacity duration-300 group-hover:opacity-100"></div>

                                        <div class="flex flex-col h-full">
                                             <div class="flex items-start justify-between mb-1">
                                                  <span class="text-2xl font-bold tracking-tight text-gray-900">
                                                       <%= user.metrics?.totalReviews || 0 %>
                                                  </span>
                                                  <div class="flex h-8 w-8 items-center justify-center rounded-full bg-purple-100/80 text-purple-600 ring-1 ring-inset ring-purple-500/20">
                                                       <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                                                       </svg>
                                                  </div>
                                             </div>

                                             <p class="text-sm font-medium text-gray-600">Avis clients</p>
                                        </div>
                                   </div>

                                   <!-- Trust Score -->
                                   <div class="group relative isolate overflow-hidden rounded-2xl bg-white p-4 shadow-sm ring-1 ring-gray-900/5 hover:shadow-md transition-all duration-300">
                                        <!-- Background Pattern -->
                                        <div class="absolute inset-0 -z-10 bg-[linear-gradient(45deg,var(--tw-gradient-from)_0%,var(--tw-gradient-to)_100%)] from-green-50 to-green-100/50 opacity-0 transition-opacity duration-300 group-hover:opacity-100"></div>

                                        <div class="flex flex-col h-full">
                                             <div class="flex items-start justify-between mb-1">
                                                  <span class="text-2xl font-bold tracking-tight text-gray-900">
                                                       <%= user.ndressilikScore || 0 %>%
                                                  </span>
                                                  <div class="flex h-8 w-8 items-center justify-center rounded-full bg-green-100/80 text-green-600 ring-1 ring-inset ring-green-500/20">
                                                       <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                                                       </svg>
                                                  </div>
                                             </div>

                                             <p class="text-sm font-medium text-gray-600">Score de confiance</p>

                                             <!-- Progress Bar -->
                                             <div class="mt-2">
                                                  <div class="h-1.5 w-full overflow-hidden rounded-full bg-gray-100">
                                                       <div class="h-full rounded-full bg-green-500 transition-all duration-500" style="width: <%= user.ndressilikScore || 0 %>%"></div>
                                                  </div>
                                             </div>
                                        </div>
                                   </div>
                              </div>

                              <style>
                                   /* Smooth hover transitions */
                                   .transition-all {
                                        transition-property: all;
                                        transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
                                        transition-duration: 300ms;
                                   }

                                   /* Card hover effect */
                                   .hover\:shadow-md:hover {
                                        box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1),
                                             0 2px 4px -2px rgb(0 0 0 / 0.1);
                                   }

                                   /* Progress bar animation */
                                   .group:hover .bg-green-500 {
                                        transition-delay: 100ms;
                                   }

                                   /* Gradient animation */
                                   @keyframes gradient {
                                        0% {
                                             background-position: 0% 50%;
                                        }

                                        50% {
                                             background-position: 100% 50%;
                                        }

                                        100% {
                                             background-position: 0% 50%;
                                        }
                                   }

                                   /* Optimize for mobile */
                                   @media (max-width: 640px) {
                                        .text-2xl {
                                             font-size: 1.25rem;
                                        }

                                        .p-4 {
                                             padding: 0.875rem;
                                        }

                                        .gap-3 {
                                             gap: 0.5rem;
                                        }
                                   }
                              </style>
                              <!-- Specializations -->
                              <div class="mt-6">
                                   <p class="text-sm font-medium text-gray-700 mb-3">Spécialisations</p>
                                   <div class="flex flex-wrap gap-2">
                                        <% const serviceIcons={ 'dog-training' : 'fa-dog' , 'grooming' : 'fa-cut' , 'walking' : 'fa-walking' , 'veterinary' : 'fa-stethoscope' , 'boarding' : 'fa-home' , 'transport' : 'fa-car' } %>

                                             <% user.specializations?.forEach(spec=> { %>
                                                  <div class="inline-flex items-center px-3 py-1.5 bg-gray-100 hover:bg-gray-200 
                                                 rounded-full transition-colors duration-200 cursor-pointer group">
                                                       <i class="fas <%= serviceIcons[spec] || 'fa-paw' %> text-gray-500 
                                                     group-hover:text-blue-500 mr-2"></i>
                                                       <span class="text-sm font-medium text-gray-700 group-hover:text-gray-900">
                                                            <%= spec.split('-').map(word=> word.charAt(0).toUpperCase() +
                                                                 word.slice(1)).join(' ') %>
                                                       </span>
                                                  </div>
                                                  <% }) %>
                                   </div>
                              </div>
                              <!-- Business Hours Display -->
                              <div class="bg-white rounded-xl shadow-md p-6">
                                   <h2 class="text-2xl font-semibold text-gray-800 mb-4">Horaires de travail</h2>
                                   <ul class="divide-y divide-gray-200">
                                        <% const days=[ { id: 'monday' , label: 'Lundi' }, { id: 'tuesday' , label: 'Mardi' }, { id: 'wednesday' , label: 'Mercredi' }, { id: 'thursday' , label: 'Jeudi' }, { id: 'friday' , label: 'Vendredi' }, { id: 'saturday' , label: 'Samedi' }, { id: 'sunday' , label: 'Dimanche' } ]; %>

                                             <% days.forEach(day=> { %>
                                                  <% const hours=user.businessHours ? user.businessHours[day.id] : null; %>
                                                       <% const isOpen=hours && (hours.isOpen===true || hours.isOpen==='true' || (hours.open && hours.close)); %>

                                                            <% if (isOpen) { %>
                                                                 <li class="py-3 flex justify-between items-center">
                                                                      <span class="text-gray-700 font-medium">
                                                                           <%= day.label %>
                                                                      </span>
                                                                      <span class="text-gray-600">
                                                                           <%= hours.open ? hours.open.replace(':', 'h' ) : '' %> - <%= hours.close ? hours.close.replace(':', 'h' ) : '' %>
                                                                      </span>
                                                                 </li>
                                                                 <% } %>
                                                                      <% }); %>
                                   </ul>

                                   <!-- Message if closed all days -->
                                   <% const isAlwaysClosed=days.every(day=> {
                                        const hours = user.businessHours ? user.businessHours[day.id] : null;
                                        const isOpen = hours && (hours.isOpen === true || hours.isOpen === 'true' || (hours.open && hours.close));
                                        return !isOpen;
                                        }); %>

                                        <% if (isAlwaysClosed) { %>
                                             <div class="text-gray-600 text-center py-6">
                                                  Ce prestataire n'a pas encore renseigné ses horaires de travail.
                                             </div>
                                             <% } %>
                              </div>

                         </div>

                         <!-- Tabs Section -->
                         <div class="mt-6 bg-white rounded-2xl shadow-sm overflow-hidden" x-data="{ activeTab: 'services' }">
                              <!-- Tab Navigation -->
                              <nav class="flex items-center gap-1 md:gap-2 overflow-x-auto no-scrollbar border-b border-gray-200">
                                   <button @click="activeTab = 'services'" :class="{'text-blue-600 border-blue-600': activeTab === 'services',
                                               'text-gray-500 hover:text-gray-700 border-transparent': activeTab !== 'services'}" class="flex items-center gap-2 px-4 py-4 font-medium border-b-2 min-w-max transition-all">
                                        <i class="fas fa-briefcase"></i>
                                        <span>Services</span>
                                        <span class="ml-1.5 text-xs py-0.5 px-2 bg-gray-100 text-gray-600 rounded-full">
                                             <%= services.length %>
                                        </span>
                                   </button>

                                   <button @click="activeTab = 'reviews'" :class="{'text-blue-600 border-blue-600': activeTab === 'reviews',
                                               'text-gray-500 hover:text-gray-700 border-transparent': activeTab !== 'reviews'}" class="flex items-center gap-2 px-4 py-4 font-medium border-b-2 min-w-max transition-all">
                                        <i class="fas fa-star"></i>
                                        <span>Avis</span>
                                        <span class="ml-1.5 text-xs py-0.5 px-2 bg-gray-100 text-gray-600 rounded-full">
                                             <%= reviews.length %>
                                        </span>
                                   </button>

                                   <button @click="activeTab = 'gallery'" :class="{'text-blue-600 border-blue-600': activeTab === 'gallery',
                                               'text-gray-500 hover:text-gray-700 border-transparent': activeTab !== 'gallery'}" class="flex items-center gap-2 px-4 py-4 font-medium border-b-2 min-w-max transition-all">
                                        <i class="fas fa-images"></i>
                                        <span>Galerie</span>
                                        <span class="ml-1.5 text-xs py-0.5 px-2 bg-gray-100 text-gray-600 rounded-full">
                                             <%= user.gallery.length %>
                                        </span>
                                   </button>

                                   <button @click="activeTab = 'about'" :class="{'text-blue-600 border-blue-600': activeTab === 'about',
                                               'text-gray-500 hover:text-gray-700 border-transparent': activeTab !== 'about'}" class="flex items-center gap-2 px-4 py-4 font-medium border-b-2 min-w-max transition-all">
                                        <i class="fas fa-user"></i>
                                        <span>À propos</span>
                                   </button>
                              </nav>

                              <!-- Tab Panels -->
                              <div class="p-6">
                                   <!-- Services Panel -->
                                   <!-- Services List Panel -->
                                   <div x-show="activeTab === 'services'" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100">
                                        <div class="space-y-4">
                                             <% services.forEach(service=> { %>
                                                  <div class="group bg-white rounded-lg border border-gray-200 hover:border-blue-500 
                                                         hover:shadow-lg transition-all duration-200 overflow-hidden">
                                                       <div class="flex flex-col sm:flex-row">
                                                            <!-- Service Image (Left Side) -->
                                                            <div class="relative w-full sm:w-48 md:w-56">
                                                                 <div class="relative aspect-video sm:aspect-square h-full">
                                                                      <img src="<%= service.images[0] %>" alt="<%= service.serviceName %>" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500">
                                                                      <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent 
                                                                         opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                                                 </div>
                                                                 <!-- Service Type Tag -->
                                                                 <div class="absolute top-3 left-3">
                                                                      <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium
                                                                          bg-blue-100 text-blue-800 border border-blue-200">
                                                                           <%= service.type || service.category %>
                                                                      </span>
                                                                 </div>
                                                            </div>

                                                            <!-- Service Content (Right Side) -->
                                                            <div class="flex-1 p-4 sm:p-5 flex flex-col">
                                                                 <div class="flex items-start justify-between gap-4 mb-2">
                                                                      <div>
                                                                           <h3 class="font-semibold text-gray-900 group-hover:text-blue-600 
                                                                            transition-colors text-lg mb-1">
                                                                                <%= service.serviceName %>
                                                                           </h3>
                                                                           <!-- Rating & Price -->
                                                                           <div class="flex items-center gap-3 text-sm text-gray-600">
                                                                                <div class="flex items-center gap-1">
                                                                                     <i class="fas fa-star text-yellow-400"></i>
                                                                                     <span class="font-medium">
                                                                                          <%= service.rating || '0.0' %>
                                                                                     </span>
                                                                                </div>
                                                                                <span class="text-gray-300">•</span>
                                                                                <span class="font-medium text-gray-900">
                                                                                     <%= service.priceRange %>
                                                                                </span>
                                                                                <span class="text-gray-500">/service</span>
                                                                           </div>
                                                                      </div>
                                                                 </div>

                                                                 <!-- Description -->
                                                                 <p class="text-sm text-gray-600 mb-4 line-clamp-2 flex-grow">
                                                                      <%= service.description %>
                                                                 </p>

                                                                 <!-- Bottom Section -->
                                                                 <div class="flex items-center justify-between mt-auto pt-3 border-t border-gray-100">
                                                                      <!-- Service Features/Tags -->
                                                                      <div class="flex flex-wrap gap-2">
                                                                           <% (service.features || []).slice(0, 2).forEach(feature=> { %>
                                                                                <span class="inline-flex items-center px-2 py-1 rounded-md text-xs
                                                                                  bg-gray-50 text-gray-600 border border-gray-100">
                                                                                     <%= feature %>
                                                                                </span>
                                                                                <% }) %>
                                                                      </div>

                                                                      <!-- Action Link -->
                                                                      <a href="/service/<%= service._id %>" class="inline-flex items-center gap-1 text-sm font-medium text-blue-600 
                                                                         hover:text-blue-700 pl-3">
                                                                           Voir détails
                                                                           <i class="fas fa-arrow-right text-xs transition-transform 
                                                                             group-hover:translate-x-1"></i>
                                                                      </a>
                                                                 </div>
                                                            </div>
                                                       </div>
                                                  </div>
                                                  <% }) %>
                                        </div>
                                   </div>

                                   <style>
                                        /* Ensure smooth transitions */
                                        .group {
                                             transform: translateZ(0);
                                        }

                                        /* Line clamp fallback for older browsers */
                                        @supports not (-webkit-line-clamp: 2) {
                                             .line-clamp-2 {
                                                  display: block;
                                                  display: -webkit-box;
                                                  -webkit-box-orient: vertical;
                                                  position: relative;
                                                  line-height: 1.5;
                                                  max-height: 3em;
                                                  overflow: hidden;
                                                  padding-right: 1rem;
                                             }

                                             .line-clamp-2::after {
                                                  content: '...';
                                                  position: absolute;
                                                  right: 0;
                                                  bottom: 0;
                                                  background: white;
                                                  padding-left: 0.25rem;
                                             }
                                        }

                                        /* Improve touch targets on mobile */
                                        @media (max-width: 640px) {
                                             .group {
                                                  cursor: pointer;
                                             }

                                             a,
                                             button {
                                                  min-height: 2.5rem;
                                                  padding: 0.5rem;
                                             }
                                        }
                                   </style>

                                   <!-- Reviews Panel -->
                                   <div x-show="activeTab === 'reviews'" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100">
                                        <div class="space-y-6">
                                             <% reviews.forEach(review=> { %>
                                                  <div class="group bg-white rounded-lg border border-gray-200 p-4 
                                                     hover:border-blue-500 hover:shadow-lg transition-all duration-200">
                                                       <div class="flex items-start gap-4">
                                                            <!-- Reviewer Avatar -->
                                                            <div class="flex-shrink-0">
                                                                 <img src="<%= review.userId.profileImage %>" alt="<%= review.userId.displayName %>" class="w-10 h-10 rounded-full object-cover">
                                                            </div>

                                                            <!-- Review Content -->
                                                            <div class="flex-1 min-w-0">
                                                                 <div class="flex items-center justify-between gap-4 mb-2">
                                                                      <div>
                                                                           <h4 class="font-medium text-gray-900">
                                                                                <%= review.userId.displayName %>
                                                                           </h4>
                                                                           <div class="flex items-center gap-2 text-sm text-gray-500">
                                                                                <div class="flex items-center">
                                                                                     <% for(let i=0; i < 5; i++) { %>
                                                                                          <i class="fas fa-star text-xs <%= i < review.rating ? 'text-yellow-400' : 'text-gray-300' %>"></i>
                                                                                          <% } %>
                                                                                </div>
                                                                                <span>•</span>
                                                                                <time datetime="<%= review.createdAt %>">
                                                                                     <%= new Date(review.createdAt).toLocaleDateString('fr-FR', { day: 'numeric' , month: 'long' , year: 'numeric' }) %>
                                                                                </time>
                                                                           </div>
                                                                      </div>
                                                                 </div>
                                                                 <p class="text-gray-600 text-sm">
                                                                      <%= review.comment %>
                                                                 </p>
                                                            </div>
                                                       </div>
                                                  </div>
                                                  <% }) %>
                                        </div>
                                   </div>

                                   <!-- Gallery Panel -->
                                   <div x-show="activeTab === 'gallery'" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100">
                                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                                             <% user.gallery.forEach(image=> { %>
                                                  <div class="group relative aspect-square rounded-lg overflow-hidden bg-gray-100 cursor-zoom-in">
                                                       <img src="<%= image %>" alt="Gallery image" class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110">

                                                       <div class="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                                                            <button onclick="openGalleryModal('<%= image %>')" class="w-10 h-10 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center transition-colors">
                                                                 <i class="fas fa-expand text-white"></i>
                                                            </button>
                                                       </div>
                                                  </div>
                                                  <% }) %>
                                        </div>
                                   </div>

                                   <!-- About Panel -->
                                   <div x-show="activeTab === 'about'" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100">
                                        <div class="max-w-3xl">
                                             <!-- Bio Section -->
                                             <div class="mb-8">
                                                  <h3 class="text-lg font-semibold text-gray-900 mb-4">Biographie</h3>
                                                  <p class="text-gray-600 whitespace-pre-line">
                                                       <%= user.bio %>
                                                  </p>
                                             </div>

                                             <!-- Experience Section -->
                                             <div class="mb-8">
                                                  <h3 class="text-lg font-semibold text-gray-900 mb-4">Expérience</h3>
                                                  <div class="bg-gray-50 rounded-lg p-4">
                                                       <div class="flex items-center gap-4">
                                                            <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center">
                                                                 <i class="fas fa-briefcase text-blue-600"></i>
                                                            </div>
                                                            <div>
                                                                 <p class="font-medium text-gray-900">
                                                                      <%= user.experience.years %> années d'expérience
                                                                 </p>
                                                                 <p class="text-gray-600">
                                                                      <%= user.experience.description %>
                                                                 </p>
                                                            </div>
                                                       </div>
                                                  </div>
                                             </div>

                                             <!-- Qualifications Section -->
                                             <div>
                                                  <h3 class="text-lg font-semibold text-gray-900 mb-4">Qualifications</h3>
                                                  <div class="space-y-4">
                                                       <% user.qualifications.forEach(qual=> { %>
                                                            <div class="bg-gray-50 rounded-lg p-4">
                                                                 <div class="flex items-start gap-4">
                                                                      <div class="w-12 h-12 rounded-full bg-purple-100 flex items-center justify-center">
                                                                           <i class="fas fa-graduation-cap text-purple-600"></i>
                                                                      </div>
                                                                      <div>
                                                                           <h4 class="font-medium text-gray-900">
                                                                                <%= qual.title %>
                                                                           </h4>
                                                                           <p class="text-gray-600">
                                                                                <%= qual.institution %> • <%= qual.year %>
                                                                           </p>
                                                                      </div>
                                                                 </div>
                                                            </div>
                                                            <% }) %>
                                                  </div>
                                             </div>
                                        </div>
                                   </div>
                              </div>
                         </div>
                    </div>
               </div>

               <!-- Gallery Modal Template -->
               <template id="gallery-modal">
                    <div class="fixed inset-0 z-50 overflow-hidden" role="dialog" aria-modal="true">
                         <div class="absolute inset-0 bg-black/90 backdrop-blur-sm"></div>
                         <div class="relative flex items-center justify-center min-h-screen p-4">
                              <div class="relative max-w-7xl w-full">
                                   <img src="" alt="Gallery image" class="max-h-[85vh] mx-auto object-contain">
                                   <button onclick="closeGalleryModal()" class="absolute top-4 right-4 w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 
                               flex items-center justify-center transition-colors">
                                        <i class="fas fa-times text-white"></i>
                                   </button>
                              </div>
                         </div>
                    </div>
               </template>

               <!-- Styles -->
               <style>
                    /* Hide scrollbar while allowing scrolling */
                    .no-scrollbar {
                         -ms-overflow-style: none;
                         scrollbar-width: none;
                    }

                    .no-scrollbar::-webkit-scrollbar {
                         display: none;
                    }

                    /* Line clamp for multi-line text truncation */
                    .line-clamp-2 {
                         display: -webkit-box;
                         -webkit-line-clamp: 2;
                         -webkit-box-orient: vertical;
                         overflow: hidden;
                    }

                    /* Animations */
                    @keyframes fadeIn {
                         from {
                              opacity: 0;
                              transform: scale(0.95);
                         }

                         to {
                              opacity: 1;
                              transform: scale(1);
                         }
                    }

                    @keyframes fadeOut {
                         from {
                              opacity: 1;
                              transform: scale(1);
                         }

                         to {
                              opacity: 0;
                              transform: scale(0.95);
                         }
                    }

                    .animate-fade-in {
                         animation: fadeIn 0.2s ease-out forwards;
                    }

                    .animate-fade-out {
                         animation: fadeOut 0.2s ease-out forwards;
                    }

                    /* Fix for iOS safari notch */
                    @supports (padding-top: env(safe-area-inset-top)) {
                         .pt-safe {
                              padding-top: env(safe-area-inset-top);
                         }
                    }
               </style>

               <!-- Scripts -->
               <script>
                    // Gallery Modal Functionality
                    function initGalleryModal() {
                         const template = document.getElementById('gallery-modal');
                         let modalInstance = null;

                         window.openGalleryModal = function (imageSrc) {
                              if (!modalInstance) {
                                   modalInstance = template.content.cloneNode(true);
                                   document.body.appendChild(modalInstance);
                              }

                              const modal = document.querySelector('[role="dialog"]');
                              const modalImg = modal.querySelector('img');
                              modalImg.src = imageSrc;

                              modal.classList.add('animate-fade-in');
                              document.body.classList.add('overflow-hidden');

                              modal.addEventListener('click', (e) => {
                                   if (e.target === modal) {
                                        closeGalleryModal();
                                   }
                              });

                              document.addEventListener('keydown', (e) => {
                                   if (e.key === 'Escape') {
                                        closeGalleryModal();
                                   }
                              });
                         };

                         window.closeGalleryModal = function () {
                              const modal = document.querySelector('[role="dialog"]');
                              if (modal) {
                                   modal.classList.add('animate-fade-out');
                                   setTimeout(() => {
                                        modal.remove();
                                        document.body.classList.remove('overflow-hidden');
                                   }, 200);
                              }
                         };
                    }

                    // Initialize functionality
                    document.addEventListener('DOMContentLoaded', () => {
                         initGalleryModal();

                         // Initialize Alpine.js data
                         Alpine.data('profileTabs', () => ({
                              activeTab: 'services',
                              loading: false,

                              init() {
                                   const hash = window.location.hash.slice(1);
                                   if (['services', 'reviews', 'gallery', 'about'].includes(hash)) {
                                        this.activeTab = hash;
                                   }

                                   this.$watch('activeTab', (value) => {
                                        window.location.hash = value;
                                   });
                              }
                         }));
                    });
               </script>