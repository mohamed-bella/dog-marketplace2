<!-- Services Management Dashboard -->
<div class="mx-auto py-8 px-4 sm:px-6" style="margin: 10px auto !important;" id="services">
     <!-- Header Section -->
     <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
          <div class="px-6 py-8 border-b border-gray-100">
               <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-6">
                    <!-- Title and Stats -->
                    <div class="flex-1">
                         <h1 class="text-2xl font-bold text-gray-900">
                              Tableau de bord des services
                              <span class="ml-2 text-sm font-medium px-3 py-1 bg-blue-50 text-blue-600 rounded-full">
                                   <%= services.length %> services
                              </span>
                         </h1>
                         <p class="mt-2 text-gray-500">Gérez et suivez vos services en temps réel</p>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-3">
                         <!-- Enhanced Search Bar -->
                         <div class="relative group">
                              <input type="text" id="searchInput" placeholder="Rechercher un service..." class="w-full sm:w-64 pl-11 pr-4 h-11 border border-gray-200 rounded-xl
                                      bg-gray-50 focus:bg-white focus:border-blue-500 focus:ring-4 
                                      focus:ring-blue-500/10 transition-all duration-300">
                              <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400
                                 group-focus-within:text-blue-500 transition-colors"></i>
                         </div>

                         <!-- New Service Button -->
                         <a href="/dashboard/new-service" class="group inline-flex items-center px-5 h-11 bg-gradient-to-r from-blue-500 to-blue-600
                              text-white rounded-xl font-medium transition-all duration-300
                              hover:shadow-lg hover:shadow-blue-500/25 hover:-translate-y-0.5 active:translate-y-0">
                              <i class="fas fa-plus mr-2 transition-transform duration-300 group-hover:rotate-180"></i>
                              Nouveau Service
                         </a>
                    </div>
               </div>
          </div>

          <!-- Table Section -->
          <div class="overflow-x-auto">
               <table class="w-full">
                    <thead>
                         <tr class="bg-gray-50/50">
                              <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                   Service
                              </th>
                              <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                   Type
                              </th>
                              <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                   Localisation
                              </th>
                              <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                   Prix
                              </th>
                              <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                   Statut
                              </th>
                              <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                   Actions
                              </th>
                         </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100">
                         <% if (services && services.length> 0) { %>
                              <% services.forEach(service=> { %>
                                   <tr class="group hover:bg-blue-50/50 transition-colors duration-200">
                                        <!-- Service Info -->
                                        <td class="px-6 py-4">
                                             <div class="flex items-center gap-4">
                                                  <img src="<%= service.images[0] %>" alt="<%= service.serviceName %>" class="h-14 w-14 rounded-xl object-cover group-hover:shadow-md transition-all">
                                                  <div>
                                                       <div class="font-medium text-gray-900 group-hover:text-blue-600 transition-colors">
                                                            <%= service.serviceName %>
                                                       </div>
                                                       <div class="text-sm text-gray-500 flex items-center gap-1">
                                                            <i class="fas fa-star text-yellow-400"></i>
                                                            <%= service.reviews?.length || 0 %> avis
                                                       </div>
                                                  </div>
                                             </div>
                                        </td>

                                        <!-- Type -->
                                        <td class="px-6 py-4">
                                             <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium
                                               bg-gradient-to-r from-blue-500/10 to-blue-600/10 text-blue-600">
                                                  <%= service.serviceOptions %>
                                             </span>
                                        </td>

                                        <!-- Location -->
                                        <td class="px-6 py-4">
                                             <div class="flex items-center text-gray-500">
                                                  <i class="fas fa-location-dot mr-2 text-gray-400"></i>
                                                  <%= service.location %>
                                             </div>
                                        </td>

                                        <!-- Price -->
                                        <td class="px-6 py-4">
                                             <div class="font-medium text-gray-900">
                                                  <%= service.priceRange %> DH
                                             </div>
                                        </td>

                                        <!-- Status Toggle -->
                                        <td class="px-6 py-4">
                                             <label class="relative inline-flex items-center cursor-pointer">
                                                  <input type="checkbox" class="sr-only peer" onchange="toggleServiceStatus('<%= service._id %>', '<%= service.status %>')" <%=service.status==='active' ? 'checked' : '' %>>
                                                  <div class="w-11 h-6 bg-gray-200 rounded-full peer 
                                                    peer-focus:ring-4 peer-focus:ring-blue-300 
                                                    peer-checked:after:translate-x-full peer-checked:bg-blue-600
                                                    after:content-[''] after:absolute after:top-[2px] after:left-[2px] 
                                                    after:bg-white after:border-gray-300 after:border after:rounded-full 
                                                    after:h-5 after:w-5 after:transition-all duration-300">
                                                  </div>
                                                  <span class="ml-3 text-sm text-gray-500">
                                                       <%= service.status==='active' ? 'Actif' : 'Inactif' %>
                                                  </span>
                                             </label>
                                        </td>

                                        <!-- Actions -->
                                        <td class="px-6 py-4">
                                             <div class="flex items-center gap-2">
                                                  <a href="/service/<%= service._id %>" class="p-2 rounded-lg hover:bg-blue-100/80 text-blue-600 
                                                  transition-all duration-300 group/btn relative">
                                                       <i class="fas fa-eye text-lg"></i>
                                                       <span class="absolute -top-12 left-1/2 -translate-x-1/2 px-3 py-1.5 
                                                        bg-gray-900 text-white text-sm rounded-lg opacity-0 
                                                        group-hover/btn:opacity-100 transition-opacity whitespace-nowrap">
                                                            Voir le service
                                                       </span>
                                                  </a>

                                                  <a href="/dashboard/services/<%= service._id %>/edit" class="p-2 rounded-lg hover:bg-emerald-100/80 text-emerald-600 
                                                  transition-all duration-300 group/btn relative">
                                                       <i class="fas fa-edit text-lg"></i>
                                                       <span class="absolute -top-12 left-1/2 -translate-x-1/2 px-3 py-1.5 
                                                        bg-gray-900 text-white text-sm rounded-lg opacity-0 
                                                        group-hover/btn:opacity-100 transition-opacity whitespace-nowrap">
                                                            Modifier
                                                       </span>
                                                  </a>

                                                  <button onclick="deleteService('<%= service._id %>')" class="p-2 rounded-lg hover:bg-red-100/80 text-red-600 
                                                       transition-all duration-300 group/btn relative">
                                                       <i class="fas fa-trash text-lg"></i>
                                                       <span class="absolute -top-12 left-1/2 -translate-x-1/2 px-3 py-1.5 
                                                        bg-gray-900 text-white text-sm rounded-lg opacity-0 
                                                        group-hover/btn:opacity-100 transition-opacity whitespace-nowrap">
                                                            Supprimer
                                                       </span>
                                                  </button>
                                             </div>
                                        </td>
                                   </tr>
                                   <% }); %>
                                        <% } %>
                    </tbody>
               </table>

               <!-- Empty State -->
               <% if (services.length===0) { %>
                    <div class="text-center py-16">
                         <div class="w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-4">
                              <i class="fas fa-cube text-2xl text-blue-500"></i>
                         </div>
                         <h3 class="text-lg font-medium text-gray-900">Aucun service trouvé</h3>
                         <p class="mt-2 text-gray-500 max-w-sm mx-auto">
                              Commencez par créer votre premier service pour gérer vos offres.
                         </p>
                         <a href="/dashboard/new-service" class="mt-6 inline-flex items-center px-5 py-2.5 bg-gradient-to-r from-blue-500 to-blue-600
                              text-white rounded-xl font-medium transition-all duration-300
                              hover:shadow-lg hover:shadow-blue-500/25 hover:-translate-y-0.5">
                              <i class="fas fa-plus mr-2"></i>
                              Créer un service
                         </a>
                    </div>
                    <% } %>
          </div>
     </div>
</div>

<script>
     // Enhanced search functionality with debounce
     function debounce(func, wait) {
          let timeout;
          return function executedFunction(...args) {
               const later = () => {
                    clearTimeout(timeout);
                    func(...args);
               };
               clearTimeout(timeout);
               timeout = setTimeout(later, wait);
          };
     }

     const searchInput = document.getElementById('searchInput');
     const handleSearch = debounce(function (e) {
          const searchText = e.target.value.toLowerCase();
          const rows = document.querySelectorAll('tbody tr');

          rows.forEach(row => {
               const serviceName = row.querySelector('td:first-child').textContent.toLowerCase();
               const shouldShow = serviceName.includes(searchText);

               if (shouldShow) {
                    row.style.display = '';
                    row.style.opacity = '1';
               } else {
                    row.style.opacity = '0';
                    setTimeout(() => {
                         row.style.display = 'none';
                    }, 300);
               }
          });
     }, 300);

     searchInput.addEventListener('input', handleSearch);

     // Enhanced status toggle with animation
     async function toggleServiceStatus(serviceId, currentStatus) {
          try {
               const response = await fetch(`/dashboard/services/${serviceId}/toggle-status`, {
                    method: 'PUT',
                    headers: {
                         'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                         status: currentStatus === 'active' ? 'inactive' : 'active'
                    })
               });

               if (!response.ok) throw new Error('Failed to update status');

               // Add success animation before reload
               const toast = document.createElement('div');
               toast.className = 'fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-0 opacity-100 transition-all duration-500';
               toast.textContent = 'Statut mis à jour avec succès';
               document.body.appendChild(toast);

               setTimeout(() => {
                    toast.style.transform = 'translateY(100%)';
                    toast.style.opacity = '0';
                    setTimeout(() => {
                         window.location.reload();
                    }, 500);
               }, 1000);

          } catch (error) {
               console.error('Error:', error);
               // Error notification
               const toast = document.createElement('div');
               toast.className = 'fixed bottom-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg';
               toast.textContent = 'Une erreur est survenue';
               document.body.appendChild(toast);
               setTimeout(() => toast.remove(), 3000);
          }
     }

     // Delete service with confirmation
     function deleteService(serviceId) {
          if (confirm('Êtes-vous sûr de vouloir supprimer ce service ?')) {
               const form = document.createElement('form');
               form.method = 'POST';
               form.action = `/dashboard/services/${serviceId}/delete`;
               document.body.appendChild(form);
               form.submit();
          }
     }
</script>

<style>
     /* Smooth transitions */
     tbody tr {
          transition: all 0.3s ease-in-out;
     }

     /* Hover effects */
     .action-button {
          transition: all 0.2s ease-in-out;
     }

     .action-button:hover {
          transform: translateY(-2px);
     }

     /* Toast animations */
     @keyframes slideIn {
          from {
               transform: translateY(100%);
               opacity: 0;
          }

          to {
               transform: translateY(0);
               opacity: 1;
          }
     }

     .toast-enter {
          animation: slideIn 0.5s ease-out forwards;
     }
</style>