<%- include('include/head.ejs') %>
     <script src="https://cdn.jsdelivr.net/npm/cheerio@1.0.0/dist/esm/index.min.js"></script>

     <body class="bg-gray-50 text-gray-900 transition-colors duration-200 ">
          <!-- Include Navbar -->
          <%- include('include/navbar.ejs') %>

               <!-- Reading Progress Bar -->
               <div class="fixed top-0 left-0 right-0 h-1 z-50">
                    <div class="progress-bar bg-blue-500 h-full w-0 transition-all duration-150"></div>
               </div>

               <!-- Floating Reading Controls -->
               <div class="fixed bottom-6 left-1/2 -translate-x-1/2 flex items-center gap-2 bg-white  rounded-full shadow-lg px-4 py-2 z-40">
                    <!-- Removed Dark Mode Toggle Button -->
                    <!-- Removed Font Size Adjustment Buttons -->

                    <!-- Share Button -->
                    <!-- <button onclick="shareArticle()" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                         <i class="fas fa-share-alt text-gray-600 dark:text-gray-300"></i>
                    </button> -->
               </div>

               <!-- Article Header -->
               <header class="relative py-20 bg-gradient-to-br from-blue-600 to-indigo-700 ">
                    <div class="absolute inset-0 bg-black/20"></div>
                    <div class="container mx-auto px-4 relative">
                         <div class="max-w-3xl mx-auto text-center text-white">
                              <!-- Category & Date -->
                              <div class="flex items-center justify-center gap-4 mb-6">
                                   <span class="px-3 py-1 bg-white/20 rounded-full text-sm backdrop-blur-sm">
                                        <%= article.category %>
                                   </span>
                                   <span class="text-white/80">
                                        <%= new Date(article.publicationDate).toLocaleDateString('fr-FR', { year: 'numeric' , month: 'long' , day: 'numeric' }) %>
                                   </span>
                              </div>

                              <!-- Title -->
                              <h1 class="text-4xl md:text-5xl font-bold mb-6 text-balance">
                                   <%= article.title %>
                              </h1>

                              <!-- Author & Read Time -->
                              <div class="flex items-center justify-center gap-4">
                                   <div class="flex items-center gap-2">
                                        <div class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center">
                                             <i class="fas fa-user"></i>
                                        </div>
                                        <span>
                                             <%= article.author %>
                                        </span>
                                   </div>
                                   <span>•</span>
                                   <span>
                                        <%= readTime %> min de lecture
                                   </span>
                              </div>

                              <!-- Social Media Sharing Options -->
                              <div class="mt-6 flex justify-center gap-4">
                                   <% const currentUrl='' ; %> <!-- Updated to dynamically capture current URL -->
                                        <a href="https://www.facebook.com/sharer/sharer.php?u=<%= encodeURIComponent(currentUrl) %>" target="_blank" class="text-white hover:text-blue-200">
                                             <i class="fab fa-facebook-f"></i>
                                        </a>
                                        <a href="https://twitter.com/intent/tweet?url=<%= encodeURIComponent(currentUrl) %>&text=<%= encodeURIComponent(article.title) %>" target="_blank" class="text-white hover:text-blue-200">
                                             <i class="fab fa-twitter"></i>
                                        </a>
                                        <a href="mailto:?subject=<%= encodeURIComponent(article.title) %>&body=<%= encodeURIComponent(currentUrl) %>" class="text-white hover:text-blue-200">
                                             <i class="fas fa-envelope"></i>
                                        </a>
                                        <a href="https://wa.me/?text=<%= encodeURIComponent(article.title + ' ' + currentUrl) %>" target="_blank" class="text-white hover:text-blue-200">
                                             <i class="fab fa-whatsapp"></i>
                                        </a>
                              </div>
                         </div>
                    </div>
               </header>

               <!-- Main Content -->
               <main class="container mx-auto">
                    <div class="flex flex-col lg:flex-row gap-8">
                         <!-- Main Article Content -->
                         <div class="w-full max-w-5xl mx-auto">
                              <!-- Article Content -->
                              <article class="bg-white rounded-2xl mb-12 mt-3">
                                   <!-- Featured Image -->
                                   <% if (article.featuredImage) { %>
                                        <img src="<%= article.featuredImage %>" alt="<%= article.title %>" class="w-full h-[400px] object-cover rounded-t-2xl">
                                        <% } %>

                                             <!-- Content -->
                                             <div class="p-2 lg:p-12">
                                                  <!-- Reading Menu (Table of Contents) -->
                                                  <nav class="mb-8">
                                                       <h2 class="text-xl font-semibold mb-4">Sommaire</h2>
                                                       <ul class="list-disc ml-5 space-y-2">
                                                            <!-- Assuming headings are h2 elements in the article content -->
                                                            <% headings.forEach(heading=> { %>
                                                                 <li>
                                                                      <a href="#<%= heading.id %>" class="text-blue-600 hover:underline">
                                                                           <%= heading.text %>
                                                                      </a>
                                                                 </li>
                                                                 <% }) %>
                                                       </ul>
                                                  </nav>

                                                  <div class="prose  prose-lg max-w-none article-content">
                                                       <%- article.content %>
                                                  </div>

                                                  <!-- Tags -->
                                                  <div class="mt-12 flex flex-wrap gap-2">
                                                       <% article.tags.filter(tag=> tag).forEach(tag => { %>
                                                            <span class="px-3 py-1 bg-gray-100  rounded-full text-sm">
                                                                 #<%= tag %>
                                                            </span>
                                                            <% }) %>
                                                  </div>
                                             </div>
                              </article>

                              <!-- Comments Section -->
                              <section id="comments" class="bg-white rounded-2xl shadow-xl p-8 lg:p-12">
                                   <h2 class="text-2xl font-bold mb-8">Réponses (<%= comments.length %>)</h2>

                                   <!-- Comment Form -->
                                   <form action="/articles/<%= article.slug %>/comments" method="POST" class="mb-12">
                                        <div class="grid gap-6">
                                             <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                  <div>
                                                       <label class="block text-sm font-medium mb-2">Nom</label>
                                                       <input type="text" name="name" required class="w-full px-4 py-2 rounded-lg border border-gray-200 bg-white  focus:ring-2 focus:ring-blue-500 ">
                                                  </div>
                                                  <div>
                                                       <label class="block text-sm font-medium mb-2">Email</label>
                                                       <input type="email" name="email" required class="w-full px-4 py-2 rounded-lg border border-gray-200 bg-white  focus:ring-2 focus:ring-blue-500 ">
                                                  </div>
                                             </div>
                                             <div>
                                                  <label class="block text-sm font-medium mb-2">Votre réponse</label>
                                                  <textarea name="comment" rows="4" required class="w-full px-4 py-2 rounded-lg border border-gray-200  bg-white focus:ring-2 focus:ring-blue-500 "></textarea>
                                             </div>
                                             <button type="submit" class="inline-flex justify-center items-center px-6 py-3 bg-blue-600 hover:bg-blue-700  text-white font-medium rounded-lg transition-colors">
                                                  <i class="fas fa-paper-plane mr-2"></i>
                                                  Publier la réponse
                                             </button>
                                        </div>
                                   </form>

                                   <!-- Comments List -->
                                   <div class="space-y-8">
                                        <% comments.forEach(comment=> { %>
                                             <div class="bg-gray-50 rounded-xl p-6">
                                                  <div class="flex items-start gap-4">
                                                       <div class="w-10 h-10 rounded-full bg-blue-100  flex items-center justify-center flex-shrink-0">
                                                            <%= comment.name.charAt(0).toUpperCase() %>
                                                       </div>
                                                       <div class="flex-1 min-w-0">
                                                            <div class="flex items-center justify-between mb-2">
                                                                 <h4 class="font-semibold truncate">
                                                                      <%= comment.name %>
                                                                 </h4>
                                                                 <time class="text-sm text-gray-500">
                                                                      <%= new Date(comment.createdAt).toLocaleDateString() %>
                                                                 </time>
                                                            </div>
                                                            <p class="text-gray-600 ">
                                                                 <%= comment.comment %>
                                                            </p>
                                                       </div>
                                                  </div>
                                             </div>
                                             <% }) %>
                                   </div>
                              </section>
                         </div>

                         <!-- Related Articles Sidebar -->
                         <!-- <aside class="w-full lg:w-1/3">
                              <div class="bg-white rounded-2xl shadow-xl p-6">
                                   <h2 class="text-xl font-semibold mb-4">Articles similaires</h2>
                                   <div class="space-y-6">
                                       
                                   </div>
                              </div>
                         </aside> -->
                    </div>
               </main>
               <%- include('include/footer.ejs') %>
                    <!-- JavaScript -->
                    <script>
                         // Removed Dark mode toggle related JavaScript

                         // Reading progress bar
                         const progressBar = document.querySelector('.progress-bar');
                         window.addEventListener('scroll', () => {
                              const winScroll = document.documentElement.scrollTop || document.body.scrollTop;
                              const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
                              const scrolled = (winScroll / height) * 100;
                              progressBar.style.width = scrolled + '%';
                         });

                         // Removed Font size adjustment JavaScript

                         // Share article
                         function shareArticle() {
                              const currentUrl = window.location.href; // Moved inside the function to dynamically get URL
                              if (navigator.share) {
                                   navigator.share({
                                        title: '<%= article.title %>',
                                        text: '<%= article.summary %>',
                                        url: currentUrl
                                   }).catch(console.error);
                              } else {
                                   // Fallback
                                   navigator.clipboard.writeText(currentUrl)
                                        .then(() => alert('Lien copié dans le presse-papiers'))
                                        .catch(() => alert('Erreur lors de la copie du lien'));
                              }
                         }

                         // Detect article language and change font and direction
                         document.addEventListener('DOMContentLoaded', () => {
                              const articleContent = document.querySelector('.article-content');
                              const text = articleContent.textContent || articleContent.innerText;
                              const arabicPattern = /[\u0600-\u06FF]/;

                              if (arabicPattern.test(text)) {
                                   articleContent.classList.add('font-arabic');
                                   articleContent.setAttribute('dir', 'rtl');
                              } else {
                                   articleContent.classList.add('font-latin');
                                   articleContent.setAttribute('dir', 'ltr');
                              }
                         });
                    </script>
     </body>

     </html>