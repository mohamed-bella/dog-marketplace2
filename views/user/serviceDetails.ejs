<%- include('include/head.ejs') %>
     <%- include('include/navbar.ejs') %>

          <!-- PhotoSwipe CSS -->
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/5.4.2/photoswipe.min.css">

          <main class="min-h-screen bg-gray-50 py-12">
               <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <!-- Service Header -->
                    <div class="mb-8">
                         <h1 class="text-3xl font-bold text-gray-900 mb-2">
                              <%= service.serviceName %>
                         </h1>
                         <p class="text-gray-600">
                              <%= service.category %>
                         </p>
                    </div>

                    <!-- Main Content Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                         <!-- Left Column - Images -->
                         <div class="space-y-6">
                              <!-- Gallery -->
                              <div class="pswp-gallery" id="gallery">
                                   <!-- Main Image -->
                                   <div class="aspect-w-16 aspect-h-9 rounded-lg overflow-hidden bg-gray-100 mb-4">
                                        <a href="<%= service.images[0] || '/images/placeholder.jpg' %>" data-pswp-width="1500" data-pswp-height="1000" target="_blank">
                                             <img src="<%= service.images[0] || '/images/placeholder.jpg' %>" alt="<%= service.serviceName %>" class="object-cover w-full h-full hover:opacity-90 transition-opacity">
                                        </a>
                                   </div>

                                   <div class="grid grid-cols-4 gap-4">
                                        <% service.images.slice(0, -1).forEach((image, index)=> { %>
                                             <a href="<%= image %>" data-pswp-width="1500" data-pswp-height="1000" class="aspect-square rounded-md overflow-hidden block" target="_blank">
                                                  <img src="<%= image %>" alt="Image <%= index + 1 %>" class="object-cover w-full h-full hover:opacity-75 transition-opacity">
                                             </a>
                                             <% }) %>
                                   </div>

                              </div>
                         </div>

                         <!-- Right Column - Info -->
                         <div class="space-y-8">
                              <!-- Description -->
                              <div>
                                   <h2 class="text-xl font-semibold text-gray-900 mb-4">Description</h2>
                                   <p class="text-gray-600 leading-relaxed">
                                        <%= service.description %>
                                   </p>
                              </div>

                              <!-- Provider Information -->
                              <div class="bg-white rounded-lg shadow-sm p-6 space-y-4">
                                   <h2 class="text-xl font-semibold text-gray-900">Contact Information</h2>

                                   <div class="space-y-3">
                                        <div>
                                             <p class="text-sm text-gray-500">Provider Name</p>
                                             <p class="text-gray-900">
                                                  <%= service.createdBy.displayName%>
                                             </p>
                                        </div>

                                        <div>
                                             <p class="text-sm text-gray-500">Email</p>
                                             <p class="text-gray-900">
                                                  <%= service.createdBy.email %>
                                             </p>
                                        </div>

                                        <div>
                                             <p class="text-sm text-gray-500">Location</p>
                                             <p class="text-gray-900">
                                                  <%= service.location || 'Location not specified' %>
                                             </p>
                                        </div>

                                        <div>
                                             <p class="text-sm text-gray-500">Phone Number</p>
                                             <p class="text-gray-900">
                                                  <%= service.serviceNumber || '+1 (555) 000-0000' %>
                                             </p>
                                        </div>
                                   </div>

                                   <!-- Contact Button -->
                                   <a href="tel:<%= service.serviceNumber %>" class="mt-6 w-full inline-flex justify-center items-center px-6 py-3 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                                        Contact Provider
                                   </a>
                              </div>

                              <!-- Share Button -->
                              <button onclick="shareService()" class="w-full inline-flex justify-center items-center px-6 py-3 border border-gray-300 rounded-md shadow-sm text-base font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                                   Share Service
                              </button>
                         </div>
                    </div>
               </div>
          </main>

          <!-- PhotoSwipe JS -->
          <script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/5.4.4/umd/photoswipe.umd.min.js"></script>
          <script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/5.4.4/umd/photoswipe-lightbox.umd.min.js"></script>

          <!-- Scripts -->
          <script>
               // Initialize PhotoSwipe
               const lightbox = new PhotoSwipeLightbox({
                    gallery: '#gallery',
                    children: 'a',
                    pswpModule: PhotoSwipe
               });
               lightbox.init();

               // Share functionality
               function shareService() {
                    if (navigator.share) {
                         navigator.share({
                              title: '<%= service.serviceName %>',
                              text: '<%= service.description.substring(0, 100) %>...',
                              url: window.location.href
                         }).catch(console.error);
                    } else {
                         alert('Sharing is not supported in your browser.');
                    }
               }

               // View tracking
               document.addEventListener('DOMContentLoaded', function () {
                    const serviceId = '<%= service._id %>';
                    const viewedServices = JSON.parse(localStorage.getItem('viewedServices') || '[]');

                    if (!viewedServices.includes(serviceId)) {
                         fetch(`/api/services/${serviceId}/view`, { method: 'POST' })
                              .then(() => {
                                   viewedServices.push(serviceId);
                                   localStorage.setItem('viewedServices', JSON.stringify(viewedServices));
                              })
                              .catch(console.error);
                    }
               });
          </script>

          <%- include('include/footer.ejs') %>