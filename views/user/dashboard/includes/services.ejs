<!-- services-dashboard.ejs -->
<div class="mx-auto py-8" id="services">
     <!-- Header Section -->
     <div class="bg-white rounded-xl shadow-sm overflow-hidden">
         <div class="px-6 py-8 border-b border-gray-100">
             <div class="flex flex-col gap-6">
                 <!-- Title and Stats -->
                 <div>
                     <h1 class="text-2xl font-semibold text-gray-900 flex items-center gap-3 flex-wrap">
                         Gestion des Services
                         <span class="px-3 py-1 bg-indigo-50 text-indigo-600 rounded-full text-sm">
                             <%= services.length %> service<%= services.length > 1 ? 's' : '' %>
                         </span>
                     </h1>
                     <p class="mt-2 text-gray-500">Gérez vos services en temps réel</p>
                 </div>
 
                 <!-- Action Buttons -->
                 <div class="flex flex-col sm:flex-row gap-4">
                     <!-- Search Bar -->
                     <div class="relative flex-1">
                         <input type="text" id="searchInput" 
                             placeholder="Rechercher un service..." 
                             class="w-full h-12 pl-12 pr-4 bg-gray-50 border border-gray-200 rounded-lg
                             focus:bg-white focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10
                             transition-all duration-200">
                         <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                     </div>
 
                     <!-- New Service Button -->
                     <a href="/dashboard/new-service" 
                         class="inline-flex items-center justify-center gap-2 px-6 h-12 
                         bg-indigo-600 text-white rounded-lg
                         transition-all duration-200 hover:bg-indigo-700">
                         <i class="fas fa-plus"></i>
                         <span>Ajouter un service</span>
                     </a>
                 </div>
             </div>
         </div>
 
         <!-- Mobile View -->
         <div class="sm:hidden">
             <% if (services && services.length > 0) { %>
                 <div class="p-4 space-y-4">
                     <% services.forEach(service => { %>
                         <div class="bg-white rounded-lg border border-gray-200 overflow-hidden
                             transition-all duration-200 hover:shadow-md">
                             <!-- Service Header -->
                             <div class="p-4">
                                 <div class="flex items-center gap-4">
                                     <img src="<%= service.images[0] %>" 
                                         alt="<%= service.serviceName %>" 
                                         class="h-16 w-16 rounded-lg object-cover">
                                     <div class="flex-1">
                                         <h3 class="font-semibold text-gray-900">
                                             <%= service.serviceName %>
                                         </h3>
                                         <div class="flex items-center gap-2 mt-1">
                                             <div class="flex items-center text-yellow-400">
                                                 <i class="fas fa-star"></i>
                                                 <span class="ml-1 text-sm text-gray-600">
                                                     <%= service.reviews?.length || 0 %> avis
                                                 </span>
                                             </div>
                                             <span class="px-2 py-1 text-sm bg-indigo-50 text-indigo-600 rounded-full">
                                                 <%= service.serviceOptions %>
                                             </span>
                                         </div>
                                     </div>
                                     
                                     <!-- Status Toggle -->
                                     <label class="relative inline-flex items-center cursor-pointer">
                                         <input type="checkbox" 
                                             class="sr-only peer" 
                                             onchange="toggleServiceStatus('<%= service._id %>', '<%= service.status %>')"
                                             <%= service.status === 'active' ? 'checked' : '' %>>
                                         <div class="w-11 h-6 bg-gray-200 rounded-full peer 
                                             peer-focus:ring-4 peer-focus:ring-indigo-300 
                                             peer-checked:after:translate-x-full peer-checked:bg-indigo-600
                                             after:content-[''] after:absolute after:top-[2px] after:left-[2px] 
                                             after:bg-white after:border-gray-300 after:border after:rounded-full 
                                             after:h-5 after:w-5 after:transition-all">
                                         </div>
                                     </label>
                                 </div>
                             </div>
 
                             <!-- Service Details -->
                             <div class="px-4 pb-4">
                                 <div class="flex flex-wrap gap-2">
                                     <span class="inline-flex items-center gap-1 px-3 py-1 text-sm 
                                         bg-gray-100 text-gray-600 rounded-full">
                                         <i class="fas fa-location-dot"></i>
                                         <%= service.location %>
                                     </span>
                                     <span class="inline-flex items-center gap-1 px-3 py-1 text-sm 
                                         bg-gray-100 text-gray-600 rounded-full">
                                         <%= service.priceRange %> DH
                                     </span>
                                 </div>
                             </div>
 
                             <!-- Actions -->
                             <div class="flex items-center justify-between px-4 py-3 bg-gray-50">
                                 <a href="/service/<%= service._id %>" 
                                     class="inline-flex items-center gap-2 px-4 py-2 text-indigo-600 rounded-lg
                                     hover:bg-indigo-50 transition-all duration-200">
                                     <i class="fas fa-eye"></i>
                                     <span>Voir</span>
                                 </a>
                                 <a href="/dashboard/services/<%= service._id %>/edit"
                                     class="inline-flex items-center gap-2 px-4 py-2 text-emerald-600 rounded-lg
                                     hover:bg-emerald-50 transition-all duration-200">
                                     <i class="fas fa-edit"></i>
                                     <span>Modifier</span>
                                 </a>
                                 <button onclick="deleteService('<%= service._id %>')"
                                     class="inline-flex items-center gap-2 px-4 py-2 text-red-600 rounded-lg
                                     hover:bg-red-50 transition-all duration-200">
                                     <i class="fas fa-trash"></i>
                                     <span>Supprimer</span>
                                 </button>
                             </div>
                         </div>
                     <% }); %>
                 </div>
             <% } %>
         </div>
 
         <!-- Desktop View -->
         <div class="hidden sm:block overflow-x-auto">
             <table class="w-full">
                 <thead>
                     <tr class="bg-gray-50">
                         <th class="px-6 py-4 text-left text-xs font-medium text-gray-500">Service</th>
                         <th class="px-6 py-4 text-left text-xs font-medium text-gray-500">Type</th>
                         <th class="px-6 py-4 text-left text-xs font-medium text-gray-500">Localisation</th>
                         <th class="px-6 py-4 text-left text-xs font-medium text-gray-500">Prix</th>
                         <th class="px-6 py-4 text-left text-xs font-medium text-gray-500">Statut</th>
                         <th class="px-6 py-4 text-left text-xs font-medium text-gray-500">Actions</th>
                     </tr>
                 </thead>
                 <tbody class="divide-y divide-gray-100">
                     <% if (services && services.length > 0) { %>
                         <% services.forEach(service => { %>
                             <tr class="group hover:bg-gray-50 transition-colors duration-200">
                                 <!-- Service Info -->
                                 <td class="px-6 py-4">
                                     <div class="flex items-center gap-4">
                                         <img src="<%= service.images[0] %>" 
                                             alt="<%= service.serviceName %>" 
                                             class="h-12 w-12 rounded-lg object-cover">
                                         <div>
                                             <div class="font-medium text-gray-900">
                                                 <%= service.serviceName %>
                                             </div>
                                             <div class="text-sm text-gray-500">
                                                 <%= service.reviews?.length || 0 %> avis
                                             </div>
                                         </div>
                                     </div>
                                 </td>
                                 
                                 <!-- Type -->
                                 <td class="px-6 py-4">
                                     <span class="inline-flex px-3 py-1 text-sm font-medium
                                         bg-indigo-50 text-indigo-600 rounded-full">
                                         <%= service.serviceOptions %>
                                     </span>
                                 </td>
 
                                 <!-- Location -->
                                 <td class="px-6 py-4">
                                     <div class="flex items-center text-gray-500">
                                         <i class="fas fa-location-dot mr-2"></i>
                                         <%= service.location %>
                                     </div>
                                 </td>
 
                                 <!-- Price -->
                                 <td class="px-6 py-4">
                                     <div class="font-medium text-gray-900">
                                         <%= service.priceRange %> DH
                                     </div>
                                 </td>
 
                                 <!-- Status -->
                                 <td class="px-6 py-4">
                                     <label class="relative inline-flex items-center cursor-pointer">
                                         <input type="checkbox" 
                                             class="sr-only peer" 
                                             onchange="toggleServiceStatus('<%= service._id %>', '<%= service.status %>')"
                                             <%= service.status === 'active' ? 'checked' : '' %>>
                                         <div class="w-11 h-6 bg-gray-200 rounded-full peer 
                                             peer-focus:ring-4 peer-focus:ring-indigo-300 
                                             peer-checked:after:translate-x-full peer-checked:bg-indigo-600
                                             after:content-[''] after:absolute after:top-[2px] after:left-[2px] 
                                             after:bg-white after:border-gray-300 after:border after:rounded-full 
                                             after:h-5 after:w-5 after:transition-all">
                                         </div>
                                     </label>
                                 </td>
 
                                 <!-- Actions -->
                                 <td class="px-6 py-4">
                                     <div class="flex items-center gap-2">
                                         <a href="/service/<%= service._id %>" 
                                             class="p-2 text-indigo-600 hover:bg-indigo-50 rounded-lg
                                             transition-all duration-200">
                                             <i class="fas fa-eye"></i>
                                         </a>
                                         <a href="/dashboard/services/<%= service._id %>/edit"
                                             class="p-2 text-emerald-600 hover:bg-emerald-50 rounded-lg
                                             transition-all duration-200">
                                             <i class="fas fa-edit"></i>
                                         </a>
                                         <button onclick="deleteService('<%= service._id %>')"
                                             class="p-2 text-red-600 hover:bg-red-50 rounded-lg
                                             transition-all duration-200">
                                             <i class="fas fa-trash"></i>
                                         </button>
                                     </div>
                                 </td>
                             </tr>
                         <% }); %>
                     <% } %>
                 </tbody>
             </table>
         </div>
 
         <!-- Empty State -->
         <% if (!services || services.length === 0) { %>
             <div class="text-center py-16">
                 <div class="w-20 h-20 bg-indigo-50 rounded-full mx-auto mb-6 
                     flex items-center justify-center">
                     <i class="fas fa-cube text-3xl text-indigo-500"></i>
                 </div>
                 <h3 class="text-xl font-semibold text-gray-900 mb-2">
                     Aucun service
                 </h3>
                 <p class="text-gray-500 max-w-sm mx-auto mb-8">
                     Commencez par ajouter votre premier service pour gérer vos offres
                 </p>
                 <a href="/dashboard/new-service" 
                     class="inline-flex items-center gap-2 px-6 py-3 
                     bg-indigo-600 text-white rounded-lg
                     transition-all duration-200 hover:bg-indigo-700">
                     <i class="fas fa-plus"></i>
                     <span>Ajouter un service</span>
                 </a>
             </div>
         <% } %>
     </div>
 </div>
 
 <script>
 // Search functionality with debounce
 function debounce(func, wait) {
     let timeout;
     return function(...args) {
         clearTimeout(timeout);
         timeout = setTimeout(() => func.apply(this, args), wait);
     };
 }
 
 const searchInput = document.getElementById('searchInput');
 const handleSearch = debounce(function(e) {
     const searchText = e.target.value.toLowerCase();
     const isMobile = window.innerWidth < 640;
     
     const elements = isMobile ? 
         document.querySelectorAll('.sm\\:hidden .bg-white') :
         document.querySelectorAll('tbody tr');
     
     elements.forEach(element => {
         const serviceName = isMobile ?
             element.querySelector('h3').textContent.toLowerCase() :
             element.querySelector('td:first-child').textContent.toLowerCase();
             
         const shouldShow = serviceName.includes(searchText);
         element.style.display = shouldShow ? '' : 'none';
         element.style.opacity = shouldShow ? '1' : '0';
     });
 }, 300);
 
 searchInput.addEventListener('input', handleSearch);
 
 // Toggle service status
 async function toggleServiceStatus(serviceId, currentStatus) {
     try {
         const response = await fetch(`/dashboard/services/${serviceId}/toggle-status`, {
             method: 'PUT',
             headers: { 'Content-Type': 'application/json' },
             body: JSON.stringify({
                 status: currentStatus === 'active' ? 'inactive' : 'active'
             })
         });
 
         if (!response.ok) throw new Error('Failed to update status');
 
         showToast('Statut mis à jour avec succès', 'success');
         setTimeout(() => window.location.reload(), 1500);
 
     } catch (error) {
         console.error('Error:', error);
         
        showToast('Une erreur est survenue', 'error');
    }
}

// Delete service
function deleteService(serviceId) {
    Swal.fire({
        title: 'Êtes-vous sûr ?',
        text: 'Cette action ne peut pas être annulée',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#ef4444',
        cancelButtonColor: '#6b7280',
        confirmButtonText: 'Oui, supprimer',
        cancelButtonText: 'Annuler',
        showLoaderOnConfirm: true,
        preConfirm: async () => {
            try {
                const response = await fetch(`/dashboard/services/${serviceId}/delete`, {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to delete service');
                }
                
                return response.json();
            } catch (error) {
                Swal.showValidationMessage(
                    `Erreur: ${error.message || 'Une erreur est survenue'}`
                );
            }
        },
        allowOutsideClick: () => !Swal.isLoading()
    }).then((result) => {
        if (result.isConfirmed) {
            showToast('Service supprimé avec succès', 'success');
            setTimeout(() => window.location.reload(), 1500);
        }
    });
}

// Toast notification system
function showToast(message, type = 'success') {
    const toast = document.createElement('div');
    toast.className = `fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg transform transition-all duration-300
        ${type === 'success' ? 'bg-green-500' : 'bg-red-500'} text-white`;
    
    toast.innerHTML = `
        <div class="flex items-center gap-2">
            <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
            <span>${message}</span>
        </div>
    `;
    
    document.body.appendChild(toast);
    
    // Animate in
    requestAnimationFrame(() => {
        toast.style.transform = 'translateY(0)';
        toast.style.opacity = '1';
    });
    
    // Remove after delay
    setTimeout(() => {
        toast.style.transform = 'translateY(100%)';
        toast.style.opacity = '0';
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}

// Enhanced mobile experience
if (window.innerWidth < 640) {
    // Add touch feedback
    const cards = document.querySelectorAll('.sm\\:hidden .bg-white');
    cards.forEach(card => {
        card.addEventListener('touchstart', () => {
            card.style.transform = 'scale(0.98)';
        });
        
        card.addEventListener('touchend', () => {
            card.style.transform = 'scale(1)';
        });
    });
}

// Table row hover effects
const tableRows = document.querySelectorAll('tbody tr');
tableRows.forEach(row => {
    row.addEventListener('mouseenter', () => {
        const actions = row.querySelector('td:last-child');
        actions.style.transform = 'translateX(0)';
        actions.style.opacity = '1';
    });
    
    row.addEventListener('mouseleave', () => {
        const actions = row.querySelector('td:last-child');
        actions.style.transform = 'translateX(10px)';
        actions.style.opacity = '0.5';
    });
});

// Initialize tooltips for action buttons
document.querySelectorAll('[data-tooltip]').forEach(element => {
    tippy(element, {
        content: element.dataset.tooltip,
        placement: 'top',
        arrow: true,
        theme: 'dark',
        delay: [100, 0]
    });
});
</script>

<style>
/* Animations and transitions */
.fade-enter {
    opacity: 0;
    transform: translateY(10px);
}

.fade-enter-active {
    opacity: 1;
    transform: translateY(0);
    transition: opacity 300ms, transform 300ms;
}

.fade-exit {
    opacity: 1;
    transform: translateY(0);
}

.fade-exit-active {
    opacity: 0;
    transform: translateY(-10px);
    transition: opacity 300ms, transform 300ms;
}

/* Status toggle animation */
.toggle-switch {
    transition: background-color 300ms;
}

.toggle-switch::after {
    transition: transform 300ms cubic-bezier(0.4, 0, 0.2, 1);
}

/* Table row hover effects */
tbody tr {
    transition: background-color 200ms;
}

tbody tr td:last-child {
    transition: transform 200ms, opacity 200ms;
    transform: translateX(10px);
    opacity: 0.5;
}

/* Mobile card effects */
@media (max-width: 640px) {
    .service-card {
        transition: transform 200ms;
    }
    
    .service-card:active {
        transform: scale(0.98);
    }
}

/* Custom scrollbar */
.overflow-x-auto {
    scrollbar-width: thin;
    scrollbar-color: #cbd5e1 #f1f5f9;
}

.overflow-x-auto::-webkit-scrollbar {
    height: 6px;
}

.overflow-x-auto::-webkit-scrollbar-track {
    background: #f1f5f9;
}

.overflow-x-auto::-webkit-scrollbar-thumb {
    background-color: #cbd5e1;
    border-radius: 3px;
}

/* Toast animations */
@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes slideOutRight {
    from {
        transform: translateX(0);
        opacity: 1;
    }
    to {
        transform: translateX(100%);
        opacity: 0;
    }
}

.toast-enter {
    animation: slideInRight 300ms ease-out forwards;
}

.toast-exit {
    animation: slideOutRight 300ms ease-in forwards;
}
</style>