<%- include('include/head.ejs') %>
     <%- include('include/navbar.ejs') %>

          <div class="bg-[#F0F2F5] min-h-screen lg:pt-20 pt-16">
               <!-- Filter Bar -->
               <div class="sticky top-16 z-20 bg-white border-b">
                    <div class="max-w-5xl mx-auto px-4">
                         <div class="flex items-center gap-3 h-14">


                              <div class="flex-1 flex items-center gap-2">
                                   <select name="location" class="flex-1 sm:flex-none w-full sm:w-44 h-9 px-3 text-sm bg-gray-100 
                                   rounded-md border-0 text-gray-700 font-medium
                                   focus:ring-1 focus:ring-blue-500" onchange="applyFilter('location', this.value)">
                                        <option value="">üìç Toutes les villes</option>
                                        <% locations.forEach(location=> { %>
                                             <option value="<%= location %>" <%=filters.location===location ? 'selected' : '' %>>
                                                  <%= location.charAt(0).toUpperCase() + location.slice(1) %>
                                             </option>
                                             <% }) %>
                                   </select>

                                   <select name="specialization" class="flex-1 sm:flex-none w-full sm:w-56 h-9 px-3 text-sm bg-gray-100 
                                   rounded-md border-0 text-gray-700 font-medium
                                   focus:ring-1 focus:ring-blue-500" onchange="applyFilter('specialization', this.value)">
                                        <option value="">üéØ Toutes les sp√©cialisations</option>
                                        <% specializations.forEach(spec=> { %>
                                             <option value="<%= spec %>" <%=filters.specialization===spec ? 'selected' : '' %>>
                                                  <%= spec.split('-').map(word=> word.charAt(0).toUpperCase() + word.slice(1)).join(' ') %>
                                             </option>
                                             <% }) %>
                                   </select>
                              </div>
                         </div>
                    </div>
               </div>

               <!-- Main Content -->
               <div class="max-w-5xl mx-auto px-4 py-6">
                    <!-- Providers List -->
                    <div class="space-y-3">
                         <% const sortedProviders=[...providers].sort((a, b)=> {
                              if (a.isVerified === b.isVerified) return 0;
                              return a.isVerified ? -1 : 1;
                              });

                              sortedProviders.forEach(provider => {
                              %>
                              <div class="bg-white rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow">
                                   <div class="flex items-start gap-4">
                                        <!-- Profile Image -->
                                        <div class="relative flex-shrink-0">
                                             <img src="<%= provider.profileImage %>" alt="<%= provider.displayName %>" class="w-16 h-16 rounded-lg object-cover bg-gray-50">
                                             <% if (provider.isVerified) { %>
                                                  <div class="absolute -top-1 -right-1 bg-blue-500 text-white p-1 rounded-full">
                                                       <i class="fas fa-check text-[10px]"></i>
                                                  </div>
                                                  <% } %>
                                        </div>

                                        <!-- Provider Info -->
                                        <div class="flex-1 min-w-0">
                                             <div class="flex items-start justify-between gap-4">
                                                  <div>
                                                       <h3 class="font-medium text-gray-900 truncate">
                                                            <%= provider.displayName %>
                                                                 <% if (provider.isVerified) { %>
                                                                      <span class="ml-1 text-xs text-blue-500">V√©rifi√©</span>
                                                                      <% } %>
                                                       </h3>
                                                       <p class="text-sm text-gray-500 flex items-center gap-1.5 mt-0.5">
                                                            <i class="fas fa-map-marker-alt text-gray-400"></i>
                                                            <%= provider.location?.city || 'Emplacement non sp√©cifi√©' %>
                                                                 <% if (provider.metrics?.averageRating) { %>
                                                                      <span class="inline-flex items-center gap-1 text-gray-600">
                                                                           ‚Ä¢ <i class="fas fa-star text-yellow-400"></i>
                                                                           <%= provider.metrics.averageRating.toFixed(1) %>
                                                                      </span>
                                                                      <% } %>
                                                       </p>
                                                  </div>
                                                  <a href="/@<%= provider.slug %>" class="flex-shrink-0 inline-flex items-center gap-1.5 px-4 h-9 
                                          bg-blue-500 hover:bg-blue-600 active:bg-blue-700 
                                          text-white text-sm font-medium rounded-md 
                                          transition-colors">
                                                       Voir le profil
                                                       <i class="fas fa-chevron-right text-xs opacity-75"></i>
                                                  </a>
                                             </div>

                                             <!-- Specializations -->
                                             <div class="flex flex-wrap gap-1.5 mt-3">
                                                  <% provider.specializations.forEach(spec=> { %>
                                                       <span class="px-2 py-1 bg-gray-50 text-gray-600 rounded text-xs font-medium">
                                                            <%= spec.split('-').map(word=> word.charAt(0).toUpperCase() + word.slice(1)).join(' ') %>
                                                       </span>
                                                       <% }) %>
                                             </div>
                                        </div>
                                   </div>
                              </div>
                              <% }) %>
                    </div>

                    <!-- Pagination -->
                    <% if (totalPages> 1) { %>
                         <div class="flex justify-center mt-6">
                              <div class="inline-flex rounded-md shadow-sm">
                                   <% for (let i=1; i <=totalPages; i++) { %>
                                        <a href="?page=<%= i %>&<%= new URLSearchParams({...filters, page: undefined}).toString() %>" class="relative inline-flex items-center px-4 py-2 text-sm font-medium
                                  <%= i === 1 ? 'rounded-l-md' : '' %>
                                  <%= i === totalPages ? 'rounded-r-md' : '' %>
                                  <%= currentPage === i 
                                      ? 'z-10 bg-blue-500 text-white' 
                                      : 'bg-white text-gray-500 hover:bg-gray-50' %>
                                  <%= i !== totalPages ? 'border-r' : '' %> border-gray-200">
                                             <%= i %>
                                        </a>
                                        <% } %>
                              </div>
                         </div>
                         <% } %>
               </div>
          </div>

          <script>
               function applyFilter(type, value) {
                    const params = new URLSearchParams(window.location.search);

                    if (value) {
                         params.set(type, value);
                    } else {
                         params.delete(type);
                    }

                    params.delete('page');
                    window.location.href = `${window.location.pathname}?${params.toString()}`;
               }
          </script>

          <%- include('include/footer.ejs') %>