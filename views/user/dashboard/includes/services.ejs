<!-- views/partials/dashboard/services.ejs -->
<div class="bg-white rounded-xl shadow-sm">
     <!-- Header Section -->
     <div class="p-6 border-b">
          <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
               <div>
                    <h2 class="text-xl font-semibold text-gray-800 mb-1">Mes Services</h2>
                    <p class="text-sm text-gray-600">Gérez vos services et suivez leurs performances</p>
               </div>

               <!-- Actions -->
               <div class="flex flex-col sm:flex-row gap-3">
                    <div class="relative">
                         <input type="text" id="serviceSearch" placeholder="Rechercher un service..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-full">
                         <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                    </div>
                    <a href="/dashboard/new-service" class="btn bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-all flex items-center justify-center gap-2 whitespace-nowrap">
                         <i class="fas fa-plus"></i>
                         Nouveau Service
                    </a>
               </div>
          </div>
     </div>

     <!-- Services Grid -->
     <div class="p-6">
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="servicesGrid">
               <% services.forEach(service=> { %>
                    <div class="service-card bg-white border rounded-xl overflow-hidden hover:shadow-lg transition-all duration-300" data-name="<%= service.serviceName %>" data-type="<%= service.serviceOptions %>" data-status="<%= service.status %>">

                         <!-- Service Image with Status Badge -->
                         <div class="relative">
                              <img src="<%= service.images[0] %>" alt="<%= service.serviceName %>" class="w-full h-48 object-cover">
                              <span class="absolute top-4 right-4 px-3 py-1 rounded-full text-sm font-medium
                                   <%= service.status === 'active' 
                                       ? 'bg-green-100 text-green-800' 
                                       : 'bg-gray-100 text-gray-800' %>">
                                   <%= service.status==='active' ? 'Actif' : 'Inactif' %>
                              </span>
                         </div>

                         <!-- Service Info -->
                         <div class="p-4 space-y-4">
                              <!-- Service Type and Location -->
                              <div class="flex items-center justify-between">
                                   <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">
                                        <%= service.serviceOptions %>
                                   </span>
                                   <span class="text-gray-600 text-sm flex items-center">
                                        <i class="fas fa-map-marker-alt mr-1"></i>
                                        <%= service.location %>
                                   </span>
                              </div>

                              <!-- Service Name -->
                              <h3 class="text-lg font-semibold text-gray-800 line-clamp-2">
                                   <%= service.serviceName %>
                              </h3>

                              <!-- Stats Row -->
                              <div class="flex items-center justify-between">
                                   <!-- Rating -->
                                   <div class="flex items-center gap-2">
                                        <div class="flex items-center text-yellow-400">
                                             <i class="fas fa-star"></i>
                                             <span class="ml-1 text-gray-700 font-medium">
                                                  <%= service.rating || '0' %>
                                             </span>
                                        </div>
                                        <span class="text-gray-500 text-sm">
                                             (<%= service.reviews?.length || 0 %> avis)
                                        </span>
                                   </div>
                                   <!-- Price -->
                                   <div class="text-gray-900 font-semibold">
                                        <%= service.priceRange %> DH
                                   </div>
                              </div>

                              <!-- Quick Actions -->
                              <div class="pt-4 border-t grid grid-cols-4 gap-2">
                                   <button onclick="window.location.href='/services/<%= service._id %>/edit'" class="flex flex-col items-center p-2 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors" title="Modifier">
                                        <i class="fas fa-edit mb-1"></i>
                                        <span class="text-xs">Modifier</span>
                                   </button>
                                   <button onclick="window.location.href='/services/<%= service._id %>/stats'" class="flex flex-col items-center p-2 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors" title="Statistiques">
                                        <i class="fas fa-chart-line mb-1"></i>
                                        <span class="text-xs">Stats</span>
                                   </button>
                                   <button onclick="window.location.href='/services/<%= service._id %>/reservations'" class="flex flex-col items-center p-2 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors" title="Réservations">
                                        <i class="fas fa-calendar-alt mb-1"></i>
                                        <span class="text-xs">Réserv.</span>
                                   </button>
                                   <button onclick="toggleServiceStatus('<%= service._id %>', '<%= service.status %>')" class="flex flex-col items-center p-2 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors" title="Changer le statut">
                                        <i class="fas <%= service.status === 'active' ? 'fa-toggle-on text-green-600' : 'fa-toggle-off text-gray-400' %> mb-1"></i>
                                        <span class="text-xs">Statut</span>
                                   </button>
                              </div>
                         </div>
                    </div>
                    <% }); %>
          </div>

          <!-- Empty State -->
          <div id="emptyState" class="hidden text-center py-12">
               <div class="mx-auto max-w-sm">
                    <i class="fas fa-search text-gray-400 text-4xl mb-4"></i>
                    <h3 class="text-lg font-medium text-gray-900 mb-2">Aucun service trouvé</h3>
                    <p class="text-gray-500 mb-6">Aucun service ne correspond à votre recherche.</p>
                    <a href="/services/new" class="text-blue-600 hover:text-blue-700 font-medium">
                         Créer un nouveau service <i class="fas fa-arrow-right ml-1"></i>
                    </a>
               </div>
          </div>
     </div>
</div>

<script>
     // Search functionality
     const searchInput = document.getElementById('serviceSearch');
     const servicesGrid = document.getElementById('servicesGrid');
     const emptyState = document.getElementById('emptyState');
     const serviceCards = document.querySelectorAll('.service-card');

     searchInput.addEventListener('input', (e) => {
          const searchTerm = e.target.value.toLowerCase();
          let hasVisibleCards = false;

          serviceCards.forEach(card => {
               const serviceName = card.dataset.name;
               const serviceType = card.dataset.type;
               const isVisible = serviceName.includes(searchTerm) || serviceType.includes(searchTerm);

               card.classList.toggle('hidden', !isVisible);
               if (isVisible) hasVisibleCards = true;
          });

          servicesGrid.classList.toggle('hidden', !hasVisibleCards);
          emptyState.classList.toggle('hidden', hasVisibleCards);
     });

     // Toggle service status
     async function toggleServiceStatus(serviceId, currentStatus) {
          try {
               const response = await fetch(`dashboard/services/${serviceId}/toggle-status`, {
                    method: 'PUT',
                    headers: {
                         'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                         status: currentStatus === 'active' ? 'inactive' : 'active'
                    })
               });

               if (response.ok) {
                    window.location.reload();
               } else {
                    throw new Error('Failed to update status');
               }
          } catch (error) {
               console.error('Error:', error);
               alert('Une erreur est survenue lors de la mise à jour du statut');
          }
     }
</script>