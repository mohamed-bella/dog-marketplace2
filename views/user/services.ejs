<%- include('include/head.ejs') %>
     <%- include('include/navbar.ejs') %>

          <div class="container">
               <!-- Flash messages -->
               <% if (messages.error && messages.error.length> 0) { %>
                    <div class="alert alert-danger" role="alert">
                         <%= messages.error[0] %>
                    </div>
                    <% } %>

                         <% if (messages.success && messages.success.length> 0) { %>
                              <div class="alert alert-success" role="alert">
                                   <%= messages.success[0] %>
                              </div>
                              <% } %>

                                   <h2 class="mb-4">Résultats de la recherche</h2>

                                   <div class="service-list">
                                        <% if (services.length===0) { %>
                                             <p>Aucun service trouvé pour cette recherche.</p>
                                             <% } else { %>
                                                  <% services.forEach((service, index)=> { %>
                                                       <div class="service-card">
                                                            <div class="service-number">
                                                                 <%= index + 1 %>.
                                                            </div>
                                                            <div class="service-image">
                                                                 <img src="https://ndressilik.s3.eu-north-1.amazonaws.com/uploads/1.png" alt="<%= service.serviceName %>">
                                                            </div>
                                                            <div class="service-info">
                                                                 <h3 class="service-name">
                                                                      <%= service.serviceName %>
                                                                 </h3>
                                                                 <p class="service-location">
                                                                      <%= service.location %>
                                                                 </p>
                                                                 <div class="service-rating">
                                                                      <span class="stars">★★★★★</span>
                                                                      <span class="review-count">
                                                                           <%= service.reviewCount || 0 %> avis
                                                                      </span>
                                                                      <span class="repeat-clients">
                                                                           <%= service.repeatClients || 0 %> clients réguliers
                                                                      </span>
                                                                 </div>
                                                                 <p class="service-description">
                                                                      <%= service.description %>
                                                                 </p>
                                                                 <p class="service-options">
                                                                      <% service.serviceOptions.forEach(option=> { %>
                                                                           <span class="badge">
                                                                                <%= option %>
                                                                           </span>
                                                                           <% }) %>
                                                                 </p>
                                                                 <p class="service-last-update">Dernière mise à jour il y a <%= service.lastUpdateDays || 0 %> jours</p>
                                                            </div>
                                                            <div class="service-price">
                                                                 <span class="price-label">à partir de</span>
                                                                 <span class="price-amount">DH <%= service.priceRange.split('-')[0] %></span>
                                                                 <span class="price-period"></span>
                                                            </div>

                                                            <!-- Like/Dislike Buttons -->
                                                            <div class="like-dislike">
                                                                 <button class="btn btn-outline-success like-btn" data-service-id="<%= service._id %>">
                                                                      <i class="fas fa-thumbs-up"></i> <span class="like-count">
                                                                           <%= service.likes || 0 %>
                                                                      </span>
                                                                 </button>
                                                                 <button class="btn btn-outline-danger dislike-btn" data-service-id="<%= service._id %>">
                                                                      <i class="fas fa-thumbs-down"></i> <span class="dislike-count">
                                                                           <%= service.dislikes || 0 %>
                                                                      </span>
                                                                 </button>
                                                            </div>
                                                       </div>
                                                       <% }) %>
                                                            <% } %>
                                   </div>
          </div>

          <style>
               .service-list {
                    display: flex;
                    flex-direction: column;
                    gap: 20px;
               }

               .service-card {
                    display: flex;
                    background-color: #fff;
                    border: 1px solid #e0e0e0;
                    border-radius: 8px;
                    padding: 20px;
                    margin-bottom: 24px;
                    position: relative;
               }

               .service-number {
                    position: absolute;
                    top: 20px;
                    left: 20px;
                    font-weight: bold;
                    color: #333;
               }

               .service-image {
                    width: 100px;
                    height: 100px;
                    margin-right: 20px;
               }

               .service-image img {
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                    border-radius: 50%;
               }

               .service-info {
                    flex-grow: 1;
               }

               .service-name {
                    font-size: 1.2rem;
                    margin-bottom: 5px;
               }

               .service-location {
                    color: #666;
                    margin-bottom: 10px;
               }

               .service-rating {
                    margin-bottom: 10px;
               }

               .stars {
                    color: #FFD700;
                    margin-right: 5px;
               }

               .review-count,
               .repeat-clients {
                    font-size: 0.9rem;
                    color: #666;
                    margin-right: 10px;
               }

               .service-description {
                    margin-bottom: 10px;
               }

               .service-options .badge {
                    background-color: #f0f0f0;
                    color: #333;
                    padding: 3px 8px;
                    border-radius: 12px;
                    font-size: 0.8rem;
                    margin-right: 5px;
               }

               .service-last-update {
                    font-size: 0.8rem;
                    color: #999;
               }

               .service-price {
                    display: flex;
                    flex-direction: column;
                    align-items: flex-end;
                    justify-content: center;
                    min-width: 100px;
               }

               .price-label {
                    font-size: 0.8rem;
                    color: #666;
               }

               .price-amount {
                    font-size: 1.5rem;
                    font-weight: bold;
                    color: #28a745;
               }

               .price-period {
                    font-size: 0.8rem;
                    color: #666;
               }

               .like-dislike {
                    margin-top: 15px;
               }

               .like-btn,
               .dislike-btn {
                    cursor: pointer;
                    margin-right: 10px;
               }
          </style>

          <script>
               document.addEventListener('DOMContentLoaded', function () {
                    // Like button click event
                    document.querySelectorAll('.like-btn').forEach(button => {
                         button.addEventListener('click', function () {
                              const serviceId = this.getAttribute('data-service-id');
                              const likeCount = this.querySelector('.like-count');
                              let count = parseInt(likeCount.textContent);

                              fetch(`/services/${serviceId}/like`, { method: 'POST' })
                                   .then(response => response.json())
                                   .then(data => {
                                        if (data.success) {
                                             likeCount.textContent = count + 1; // Increment like count
                                             location.reload(); // Reload the page to show flash messages
                                        }
                                   })
                                   .catch(err => console.error('Error liking service:', err));
                         });
                    });

                    // Dislike button click event
                    document.querySelectorAll('.dislike-btn').forEach(button => {
                         button.addEventListener('click', function () {
                              const serviceId = this.getAttribute('data-service-id');
                              const dislikeCount = this.querySelector('.dislike-count');
                              let count = parseInt(dislikeCount.textContent);

                              fetch(`/services/${serviceId}/dislike`, { method: 'POST' })
                                   .then(response => response.json())
                                   .then(data => {
                                        if (data.success) {
                                             dislikeCount.textContent = count + 1; // Increment dislike count
                                             location.reload(); // Reload the page to show flash messages
                                        }
                                   })
                                   .catch(err => console.error('Error disliking service:', err));
                         });
                    });
               });
          </script>




          <%- include('include/footer.ejs') %>