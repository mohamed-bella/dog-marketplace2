<%- include('partials/head.ejs') %>
     <%- include('partials/navbar.ejs') %>

          <div class="container mt-5">
               <h1 class="text-center my-4" style="color: #000;">
                    <%= announcement.breed %>
               </h1>

               <div class="row">
                    <!-- Image Gallery Section -->
                    <div class="col-md-8">
                         <div class="card shadow-sm" style="border: 1px solid #ddd; border-radius: 5px; background-color: #fff;">
                              <div class="card-body">
                                   <!-- Large Media (Image or Video) -->
                                   <div class="main-image mb-3">
                                        <% if (announcement.media[0].endsWith('.jpg') || announcement.media[0].endsWith('.jpeg') || announcement.media[0].endsWith('.png') || announcement.media[0].endsWith('.gif')) { %>
                                             <!-- Display Image -->
                                             <img id="mainImage" src="<%= announcement.media[0] || 'https://via.placeholder.com/600x400' %>" class="img-fluid w-100" alt="Media for <%= announcement.title %>" style="object-fit: cover; border-radius: 4px;">
                                             <% } else if (announcement.media[0].endsWith('.mp4') || announcement.media[0].endsWith('.webm') || announcement.media[0].endsWith('.ogg')) { %>
                                                  <!-- Display Video -->
                                                  <video id="mainVideo" src="<%= announcement.media[0] %>" class="img-fluid w-100" style="object-fit: cover; border-radius: 4px;" controls>
                                                       Your browser does not support the video tag.
                                                  </video>
                                                  <% } else { %>
                                                       <!-- Default Placeholder -->
                                                       <img id="mainImage" src="https://via.placeholder.com/600x400" class="img-fluid w-100" alt="Media for <%= announcement.title %>" style="object-fit: cover; border-radius: 4px;">
                                                       <% } %>
                                   </div>
                    
                                   <!-- Thumbnail Images/Videos -->
                                   <div class="thumbnail-images d-flex justify-content-center flex-wrap">
                                        <% announcement.media.forEach(function(media, index) { %>
                                             <% if (media.endsWith('.jpg') || media.endsWith('.jpeg') || media.endsWith('.png') || media.endsWith('.gif')) { %>
                                                  <!-- Image Thumbnail -->
                                                  <img src="<%= media %>" class="img-thumbnail small-image me-2 mb-2" alt="Thumbnail <%= index + 1 %>" style="cursor: pointer; width: 60px; height: 60px; object-fit: cover;" onclick="setMainMedia('<%= media %>')">
                                                  <% } else if (media.endsWith('.mp4') || media.endsWith('.webm') || media.endsWith('.ogg')) { %>
                                                       <!-- Video Thumbnail -->
                                                       <video src="<%= media %>" class="img-thumbnail small-image me-2 mb-2" alt="Thumbnail <%= index + 1 %>" style="cursor: pointer; width: 60px; height: 60px; object-fit: cover;" onclick="setMainMedia('<%= media %>', 'video')"></video>
                                                       <% } %>
                                                            <% }); %>
                                   </div>
                              </div>
                         </div>
                    </div>
                    
                    <script>
                         function setMainMedia(mediaUrl, type = 'image') {
                              const mainImage = document.getElementById('mainImage');
                              const mainVideo = document.getElementById('mainVideo');

                              if (type === 'video') {
                                   if (mainImage) mainImage.style.display = 'none';
                                   if (mainVideo) {
                                        mainVideo.src = mediaUrl;
                                        mainVideo.style.display = 'block';
                                   }
                              } else {
                                   if (mainVideo) mainVideo.style.display = 'none';
                                   if (mainImage) {
                                        mainImage.src = mediaUrl;
                                        mainImage.style.display = 'block';
                                   }
                              }
                         }
                    </script>


                    <!-- Seller Information Card -->
                    <div class="col-md-4">
                         <div class="card shadow-sm" style="border: 1px solid #ddd; border-radius: 5px; background-color: #fff;">
                              <div class="card-body">
                                   <h5 class="text-center" style="color: #000; font-size: 1.25rem;">Vendeur</h5>
                                   <hr>
                                   <div class="row align-items-center p-3 mb-2" style="background-color: #f8f9fa; border-radius: 10px;">
                                        <div class="col-3 text-center">
                                             <i class="bi bi-person-circle" style="font-size: 2rem; color: #6c757d;"></i>
                                        </div>
                                        <div class="col-9">
                                             <strong style="color: #000; font-size: 0.875rem;">
                                                  <%= announcement.sellerDisplayName %>
                                             </strong>
                                        </div>
                                   </div>

                                   <!-- Phone Number and Call Button -->
                                   <div class="text-center">
                                        <a id="phoneNumber" href="tel:<%= announcement.number %>" style="display: none; color: #000; font-size: 0.875rem;">
                                             Téléphone: <%= announcement.number %>
                                        </a>

                                        <button id="showNumberBtn" class="btn btn-warning mt-2 w-100" style="background-color: #f1c40f; border-color: #f1c40f; color: black;">
                                             <i class="bi bi-telephone-fill"></i> Appeler
                                        </button>
                                   </div>
                              </div>
                         </div>
                    </div>
               </div>

               <!-- Announcement Details Section -->
               <div class="row mt-4">
                    <div class="col-md-12">
                         <div class="card shadow-sm" style="border: 1px solid #ddd; border-radius: 5px; background-color: #fff;">
                              <div class="card-body">

                                   <!-- Description Section -->
                                   <h5 class="d-flex align-items-center" style="color: #000; font-size: 1.25rem;">
                                        <i class="bi bi-file-text-fill me-2" style="font-size: 1.5rem; color: #3498db;"></i> Description
                                   </h5>
                                   <p style="color: #000; font-size: 0.875rem;">
                                        <%= announcement.description %>
                                   </p>

                                   <hr style="margin: 1.5rem 0; border-color: #ddd;"> <!-- Line separator -->

                                   <!-- Price Section -->
                                   <h5 class="d-flex align-items-center" style="color: #000; font-size: 1.25rem;">
                                        <i class="bi bi-currency-dollar me-2" style="font-size: 1.5rem; color: #27ae60;"></i> Prix
                                   </h5>
                                   <p style="color: #000; font-size: 0.875rem;"><strong>
                                             <%= announcement.price %> MAD
                                        </strong></p>

                                   <hr style="margin: 1.5rem 0; border-color: #ddd;"> <!-- Line separator -->

                                   <!-- Location Section -->
                                   <h5 class="d-flex align-items-center" style="color: #000; font-size: 1.25rem;">
                                        <i class="bi bi-geo-alt-fill me-2" style="font-size: 1.5rem; color: #e74c3c;"></i> Lieu
                                   </h5>
                                   <p style="color: #000; font-size: 0.875rem;">
                                        <%= announcement.location %>
                                   </p>

                                   <hr style="margin: 1.5rem 0; border-color: #ddd;"> <!-- Line separator -->

                                   <!-- Date Section -->
                                   <h5 class="d-flex align-items-center" style="color: #000; font-size: 1.25rem;">
                                        <i class="bi bi-calendar3 me-2" style="font-size: 1.5rem; color: #f39c12;"></i> Date de publication
                                   </h5>
                                   <p style="color: #000; font-size: 0.875rem;">
                                        <%= announcement.datePosted.toLocaleDateString('fr-FR') %>
                                   </p>

                                   <!-- Back Button -->
                                   <a href="/announcements" class="btn btn-secondary mt-3" style="font-size: 0.875rem;"> <i class="bi bi-arrow-left"></i> Retour à la liste</a>
                              </div>
                         </div>
                    </div>
               </div>

          </div>

          <!-- Fixed Call Button for Mobile Devices -->
          <div class="fixed-call-btn d-md-none">
               <button id="fixedCallButton" class="btn btn-warning w-100" style="background-color: #f1c40f; border-color: #f1c40f; color: black;">
                    <i class="bi bi-telephone-fill"></i> Appeler
               </button>
          </div>

          <%- include('partials/footer.ejs') %>

               <script>
                    // JavaScript to change the main image when a thumbnail is clicked
                    const thumbnailImages = document.querySelectorAll('.small-image');
                    const mainImage = document.getElementById('mainImage');

                    thumbnailImages.forEach(img => {
                         img.addEventListener('click', function () {
                              mainImage.src = this.src;
                         });
                    });

                    // JavaScript to reveal the full phone number when the button is clicked
                    document.getElementById('showNumberBtn').addEventListener('click', function () {
                         const phoneNumberElement = document.getElementById('phoneNumber');
                         phoneNumberElement.style.display = 'block';  // Show the phone number
                         this.style.display = 'none';  // Hide the button after showing the number
                    });

                    // Same functionality for fixed call button on mobile
                    document.getElementById('fixedCallButton').addEventListener('click', function () {
                         const phoneNumberElement = document.getElementById('phoneNumber');
                         phoneNumberElement.style.display = 'block';  // Show the phone number
                         document.getElementById('showNumberBtn').style.display = 'none';  // Hide the button after showing the number
                         this.style.display = 'none';  // Hide the button after showing the number
                    });
               </script>

               <style>
                    .fixed-call-btn {
                         position: fixed;
                         bottom: 0;
                         left: 0;
                         right: 0;
                         padding: 10px;
                         background-color: rgba(255, 255, 255, 0.9);
                         z-index: 1000;
                         border-top: 1px solid #ddd;
                    }
               </style>