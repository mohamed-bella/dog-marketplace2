<%- include('include/head') %>
     <%- include('include/navbar') %>

          <div class="bg-white">
               <!-- Stats and Quick Access Section -->
               <div class="min-h-screen bg-gray-50">
                    <!-- Mobile Header -->
                    <header class="sticky top-0 z-50 bg-white border-b border-gray-100">
                         <div class="max-w-2xl mx-auto px-4 py-3 flex items-center justify-between">
                              <button class="p-2 hover:bg-gray-50 rounded-full">
                                   <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                                   </svg>
                              </button>
                              <h1 class="text-lg font-medium">
                                   <%= user.displayName %>
                              </h1>
                              <div class="relative" x-data="{ open: false }">
                                   <button @click="open = !open" class="p-2 hover:bg-gray-50 rounded-full">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                                        </svg>
                                   </button>
                              </div>
                         </div>
                    </header>

                    <!-- Main Content -->
                    <div class="max-w-2xl mx-auto px-4 py-6">
                         <!-- Profile Card -->
                         <div class="bg-white rounded-2xl p-6 shadow-sm">
                              <!-- Profile Header -->
                              <div class="flex flex-col items-center">
                                   <div class="relative">
                                        <div class="w-24 h-24 rounded-full overflow-hidden ring-4 ring-gray-50">
                                             <img src="<%= user.profileImage %>" alt="<%= user.displayName %>" class="w-full h-full object-cover">
                                        </div>
                                        <% if (user.isVerified) { %>
                                             <div class="absolute -right-1 -bottom-1">
                                                  <img src="https://img.icons8.com/?size=100&id=4vNqm6VhTbfY&format=png&color=FAB005" alt="Verified" class="w-6 h-6" data-tooltip="Compte vérifié">
                                             </div>
                                             <% } %>
                                   </div>

                                   <!-- Name and Role -->
                                   <div class="mt-4 text-center">
                                        <h2 class="text-xl font-semibold text-gray-900">
                                             <%= user.displayName %>
                                        </h2>
                                        <div class="mt-1 inline-flex items-center px-3 py-1 rounded-full text-sm font-medium
                                            bg-blue-50 text-blue-600">
                                             <%= user.role==='provider' ? 'Prestataire de service' : 'Client' %>
                                        </div>
                                   </div>
                                   <!-- Badges Display -->
                                   <% if (user.badges && user.badges.length> 0) { %>
                                        <!-- Primary Badge (First/Most Important) -->
                                        <div class="flex flex-col items-center mb-6">
                                             <div class="relative">
                                                  <img src="<%= user.badges[0].icon %>" alt="<%= user.badges[0].label %>" class="w-12 h-12 object-contain">
                                                  <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-white"></div>
                                             </div>
                                             <span class="mt-2 inline-flex items-center px-3 py-1 rounded-full text-sm font-medium
                                                        <%= user.badges[0].bgColor %> <%= user.badges[0].textColor %>">
                                                  <%= user.badges[0].label %>
                                             </span>
                                        </div>
                                   
                                        <!-- Other Badges -->
                                        <div class="flex flex-wrap gap-3 mt-4">
                                             <% user.badges.slice(1).forEach(badge=> { %>
                                                  <div class="group relative">
                                                       <div class="flex items-center gap-2 px-3 py-2 rounded-lg
                                                              <%= badge.bgColor %> <%= badge.textColor %>
                                                              transition-all duration-200 hover:shadow-md">
                                                            <img src="<%= badge.icon %>" alt="<%= badge.label %>" class="w-5 h-5 object-contain">
                                                            <span class="text-sm font-medium">
                                                                 <%= badge.label %>
                                                            </span>
                                                       </div>
                                   
                                                       <!-- Tooltip -->
                                                       <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2
                                                              bg-gray-900 text-white text-xs rounded-lg opacity-0 invisible
                                                              group-hover:opacity-100 group-hover:visible transition-all duration-200">
                                                            <div class="text-center whitespace-nowrap">
                                                                 <p>
                                                                      <%= badge.description %>
                                                                 </p>
                                                                 <p class="mt-1 text-gray-400">Obtenu le <%= badge.earnedAt %>
                                                                 </p>
                                                            </div>
                                                            <!-- Tooltip Arrow -->
                                                            <div class="absolute bottom-[-8px] left-1/2 transform -translate-x-1/2
                                                                  border-t-8 border-r-8 border-l-8 
                                                                  border-t-gray-900 border-r-transparent border-l-transparent"></div>
                                                       </div>
                                                  </div>
                                                  <% }) %>
                                        </div>
                                        <% } %>
                                   
                                             <style>
                                                  /* Smooth tooltip transitions */
                                                  .group:hover .absolute {
                                                       transition-delay: 100ms;
                                                  }
                                   
                                                  /* Badge hover effect */
                                                  .group:hover img {
                                                       transform: scale(1.1);
                                                       transition: transform 0.2s ease-in-out;
                                                  }
                                             </style>
                              </div>

                              <!-- Stats Grid -->
                              <div class="mt-8 grid grid-cols-2 md:grid-cols-4 gap-4">
                                   <!-- Rating Stat -->
                                   <div class="bg-gray-50 rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-2">
                                             <div class="text-2xl font-bold text-gray-900">
                                                  <%= user.metrics?.averageRating?.toFixed(1) || '0.0' %>
                                             </div>
                                             <div class="flex -space-x-1">
                                                  <% Array(5).fill().forEach((_, i)=> { %>
                                                       <div class="w-4 h-4 rounded-full bg-yellow-400 border-2 border-white"></div>
                                                       <% }) %>
                                             </div>
                                        </div>
                                        <p class="text-sm text-gray-600">Note moyenne</p>
                                   </div>

                                   <!-- Services Stat -->
                                   <div class="bg-gray-50 rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-2">
                                             <div class="text-2xl font-bold text-gray-900">
                                                  <%= user.metrics?.totalServices || 0 %>
                                             </div>
                                             <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
                                                  <i class="fas fa-briefcase text-blue-600"></i>
                                             </div>
                                        </div>
                                        <p class="text-sm text-gray-600">Services</p>
                                   </div>

                                   <!-- Reviews Stat -->
                                   <div class="bg-gray-50 rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-2">
                                             <div class="text-2xl font-bold text-gray-900">
                                                  <%= user.metrics?.totalReviews || 0 %>
                                             </div>
                                             <div class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center">
                                                  <i class="fas fa-comment-dots text-purple-600"></i>
                                             </div>
                                        </div>
                                        <p class="text-sm text-gray-600">Avis clients</p>
                                   </div>

                                   <!-- Trust Score -->
                                   <div class="relative bg-gray-50 rounded-lg p-4 overflow-hidden">
                                        <div class="flex items-center justify-between mb-2 relative z-10">
                                             <div class="text-2xl font-bold text-gray-900">
                                                  <%= user.ndressilikScore || 0 %>%
                                             </div>
                                             <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center">
                                                  <i class="fas fa-shield-alt text-green-600"></i>
                                             </div>
                                        </div>
                                        <p class="text-sm text-gray-600 relative z-10">Score de confiance</p>
                                        <!-- Progress Bar -->
                                        <div class="absolute bottom-0 left-0 h-1 bg-green-200 w-full">
                                             <div class="h-full bg-green-500" style="width: <%= user.ndressilikScore || 0 %>%"></div>
                                        </div>
                                   </div>
                              </div>

                              <!-- Specializations -->
                              <div class="mt-6">
                                   <p class="text-sm font-medium text-gray-700 mb-3">Spécialisations</p>
                                   <div class="flex flex-wrap gap-2">
                                        <% const serviceIcons={ 'dog-training' : 'fa-dog' , 'grooming' : 'fa-cut' , 'walking' : 'fa-walking' , 'veterinary' : 'fa-stethoscope' , 'boarding' : 'fa-home' , 'transport' : 'fa-car' } %>

                                             <% user.specializations?.forEach(spec=> { %>
                                                  <div class="inline-flex items-center px-3 py-1.5 bg-gray-100 hover:bg-gray-200 
                                                 rounded-full transition-colors duration-200 cursor-pointer group">
                                                       <i class="fas <%= serviceIcons[spec] || 'fa-paw' %> text-gray-500 
                                                     group-hover:text-blue-500 mr-2"></i>
                                                       <span class="text-sm font-medium text-gray-700 group-hover:text-gray-900">
                                                            <%= spec.split('-').map(word=> word.charAt(0).toUpperCase() +
                                                                 word.slice(1)).join(' ') %>
                                                       </span>
                                                  </div>
                                                  <% }) %>
                                   </div>
                              </div>
                         </div>

                         <!-- Tabs Section -->
                         <div class="mt-6 bg-white rounded-2xl shadow-sm overflow-hidden" x-data="{ activeTab: 'services' }">
                              <!-- Tab Navigation -->
                              <nav class="flex items-center gap-1 md:gap-2 overflow-x-auto no-scrollbar border-b border-gray-200">
                                   <button @click="activeTab = 'services'" :class="{'text-blue-600 border-blue-600': activeTab === 'services',
                                               'text-gray-500 hover:text-gray-700 border-transparent': activeTab !== 'services'}" class="flex items-center gap-2 px-4 py-4 font-medium border-b-2 min-w-max transition-all">
                                        <i class="fas fa-briefcase"></i>
                                        <span>Services</span>
                                        <span class="ml-1.5 text-xs py-0.5 px-2 bg-gray-100 text-gray-600 rounded-full">
                                             <%= services.length %>
                                        </span>
                                   </button>

                                   <button @click="activeTab = 'reviews'" :class="{'text-blue-600 border-blue-600': activeTab === 'reviews',
                                               'text-gray-500 hover:text-gray-700 border-transparent': activeTab !== 'reviews'}" class="flex items-center gap-2 px-4 py-4 font-medium border-b-2 min-w-max transition-all">
                                        <i class="fas fa-star"></i>
                                        <span>Avis</span>
                                        <span class="ml-1.5 text-xs py-0.5 px-2 bg-gray-100 text-gray-600 rounded-full">
                                             <%= reviews.length %>
                                        </span>
                                   </button>

                                   <button @click="activeTab = 'gallery'" :class="{'text-blue-600 border-blue-600': activeTab === 'gallery',
                                               'text-gray-500 hover:text-gray-700 border-transparent': activeTab !== 'gallery'}" class="flex items-center gap-2 px-4 py-4 font-medium border-b-2 min-w-max transition-all">
                                        <i class="fas fa-images"></i>
                                        <span>Galerie</span>
                                        <span class="ml-1.5 text-xs py-0.5 px-2 bg-gray-100 text-gray-600 rounded-full">
                                             <%= user.gallery.length %>
                                        </span>
                                   </button>

                                   <button @click="activeTab = 'about'" :class="{'text-blue-600 border-blue-600': activeTab === 'about',
                                               'text-gray-500 hover:text-gray-700 border-transparent': activeTab !== 'about'}" class="flex items-center gap-2 px-4 py-4 font-medium border-b-2 min-w-max transition-all">
                                        <i class="fas fa-user"></i>
                                        <span>À propos</span>
                                   </button>
                              </nav>

                              <!-- Tab Panels -->
                              <div class="p-6">
                                   <!-- Services Panel -->
                                   <!-- Services List Panel -->
                                   <div x-show="activeTab === 'services'" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100">
                                        <div class="space-y-4">
                                             <% services.forEach(service=> { %>
                                                  <div class="group bg-white rounded-lg border border-gray-200 hover:border-blue-500 
                                                         hover:shadow-lg transition-all duration-200 overflow-hidden">
                                                       <div class="flex flex-col sm:flex-row">
                                                            <!-- Service Image (Left Side) -->
                                                            <div class="relative w-full sm:w-48 md:w-56">
                                                                 <div class="relative aspect-video sm:aspect-square h-full">
                                                                      <img src="<%= service.images[0] %>" alt="<%= service.serviceName %>" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500">
                                                                      <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent 
                                                                         opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                                                 </div>
                                                                 <!-- Service Type Tag -->
                                                                 <div class="absolute top-3 left-3">
                                                                      <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium
                                                                          bg-blue-100 text-blue-800 border border-blue-200">
                                                                           <%= service.type || service.category %>
                                                                      </span>
                                                                 </div>
                                                            </div>

                                                            <!-- Service Content (Right Side) -->
                                                            <div class="flex-1 p-4 sm:p-5 flex flex-col">
                                                                 <div class="flex items-start justify-between gap-4 mb-2">
                                                                      <div>
                                                                           <h3 class="font-semibold text-gray-900 group-hover:text-blue-600 
                                                                            transition-colors text-lg mb-1">
                                                                                <%= service.serviceName %>
                                                                           </h3>
                                                                           <!-- Rating & Price -->
                                                                           <div class="flex items-center gap-3 text-sm text-gray-600">
                                                                                <div class="flex items-center gap-1">
                                                                                     <i class="fas fa-star text-yellow-400"></i>
                                                                                     <span class="font-medium">
                                                                                          <%= service.rating || '0.0' %>
                                                                                     </span>
                                                                                </div>
                                                                                <span class="text-gray-300">•</span>
                                                                                <span class="font-medium text-gray-900">
                                                                                     <%= service.priceRange %>
                                                                                </span>
                                                                                <span class="text-gray-500">/service</span>
                                                                           </div>
                                                                      </div>
                                                                 </div>

                                                                 <!-- Description -->
                                                                 <p class="text-sm text-gray-600 mb-4 line-clamp-2 flex-grow">
                                                                      <%= service.description %>
                                                                 </p>

                                                                 <!-- Bottom Section -->
                                                                 <div class="flex items-center justify-between mt-auto pt-3 border-t border-gray-100">
                                                                      <!-- Service Features/Tags -->
                                                                      <div class="flex flex-wrap gap-2">
                                                                           <% (service.features || []).slice(0, 2).forEach(feature=> { %>
                                                                                <span class="inline-flex items-center px-2 py-1 rounded-md text-xs
                                                                                  bg-gray-50 text-gray-600 border border-gray-100">
                                                                                     <%= feature %>
                                                                                </span>
                                                                                <% }) %>
                                                                      </div>

                                                                      <!-- Action Link -->
                                                                      <a href="/service/<%= service._id %>" class="inline-flex items-center gap-1 text-sm font-medium text-blue-600 
                                                                         hover:text-blue-700 pl-3">
                                                                           Voir détails
                                                                           <i class="fas fa-arrow-right text-xs transition-transform 
                                                                             group-hover:translate-x-1"></i>
                                                                      </a>
                                                                 </div>
                                                            </div>
                                                       </div>
                                                  </div>
                                                  <% }) %>
                                        </div>
                                   </div>

                                   <style>
                                        /* Ensure smooth transitions */
                                        .group {
                                             transform: translateZ(0);
                                        }

                                        /* Line clamp fallback for older browsers */
                                        @supports not (-webkit-line-clamp: 2) {
                                             .line-clamp-2 {
                                                  display: block;
                                                  display: -webkit-box;
                                                  -webkit-box-orient: vertical;
                                                  position: relative;
                                                  line-height: 1.5;
                                                  max-height: 3em;
                                                  overflow: hidden;
                                                  padding-right: 1rem;
                                             }

                                             .line-clamp-2::after {
                                                  content: '...';
                                                  position: absolute;
                                                  right: 0;
                                                  bottom: 0;
                                                  background: white;
                                                  padding-left: 0.25rem;
                                             }
                                        }

                                        /* Improve touch targets on mobile */
                                        @media (max-width: 640px) {
                                             .group {
                                                  cursor: pointer;
                                             }

                                             a,
                                             button {
                                                  min-height: 2.5rem;
                                                  padding: 0.5rem;
                                             }
                                        }
                                   </style>

                                   <!-- Reviews Panel -->
                                   <div x-show="activeTab === 'reviews'" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100">
                                        <div class="space-y-6">
                                             <% reviews.forEach(review=> { %>
                                                  <div class="group bg-white rounded-lg border border-gray-200 p-4 
                                                     hover:border-blue-500 hover:shadow-lg transition-all duration-200">
                                                       <div class="flex items-start gap-4">
                                                            <!-- Reviewer Avatar -->
                                                            <div class="flex-shrink-0">
                                                                 <img src="<%= review.userId.profileImage %>" alt="<%= review.userId.displayName %>" class="w-10 h-10 rounded-full object-cover">
                                                            </div>

                                                            <!-- Review Content -->
                                                            <div class="flex-1 min-w-0">
                                                                 <div class="flex items-center justify-between gap-4 mb-2">
                                                                      <div>
                                                                           <h4 class="font-medium text-gray-900">
                                                                                <%= review.userId.displayName %>
                                                                           </h4>
                                                                           <div class="flex items-center gap-2 text-sm text-gray-500">
                                                                                <div class="flex items-center">
                                                                                     <% for(let i=0; i < 5; i++) { %>
                                                                                          <i class="fas fa-star text-xs <%= i < review.rating ? 'text-yellow-400' : 'text-gray-300' %>"></i>
                                                                                          <% } %>
                                                                                </div>
                                                                                <span>•</span>
                                                                                <time datetime="<%= review.createdAt %>">
                                                                                     <%= new Date(review.createdAt).toLocaleDateString('fr-FR', { day: 'numeric' , month: 'long' , year: 'numeric' }) %>
                                                                                </time>
                                                                           </div>
                                                                      </div>
                                                                 </div>
                                                                 <p class="text-gray-600 text-sm">
                                                                      <%= review.comment %>
                                                                 </p>
                                                            </div>
                                                       </div>
                                                  </div>
                                                  <% }) %>
                                        </div>
                                   </div>

                                   <!-- Gallery Panel -->
                                   <div x-show="activeTab === 'gallery'" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100">
                                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                                             <% user.gallery.forEach(image=> { %>
                                                  <div class="group relative aspect-square rounded-lg overflow-hidden bg-gray-100 cursor-zoom-in">
                                                       <img src="<%= image %>" alt="Gallery image" class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110">

                                                       <div class="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                                                            <button onclick="openGalleryModal('<%= image %>')" class="w-10 h-10 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center transition-colors">
                                                                 <i class="fas fa-expand text-white"></i>
                                                            </button>
                                                       </div>
                                                  </div>
                                                  <% }) %>
                                        </div>
                                   </div>

                                   <!-- About Panel -->
                                   <div x-show="activeTab === 'about'" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100">
                                        <div class="max-w-3xl">
                                             <!-- Bio Section -->
                                             <div class="mb-8">
                                                  <h3 class="text-lg font-semibold text-gray-900 mb-4">Biographie</h3>
                                                  <p class="text-gray-600 whitespace-pre-line">
                                                       <%= user.bio %>
                                                  </p>
                                             </div>

                                             <!-- Experience Section -->
                                             <div class="mb-8">
                                                  <h3 class="text-lg font-semibold text-gray-900 mb-4">Expérience</h3>
                                                  <div class="bg-gray-50 rounded-lg p-4">
                                                       <div class="flex items-center gap-4">
                                                            <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center">
                                                                 <i class="fas fa-briefcase text-blue-600"></i>
                                                            </div>
                                                            <div>
                                                                 <p class="font-medium text-gray-900">
                                                                      <%= user.experience.years %> années d'expérience
                                                                 </p>
                                                                 <p class="text-gray-600">
                                                                      <%= user.experience.description %>
                                                                 </p>
                                                            </div>
                                                       </div>
                                                  </div>
                                             </div>

                                             <!-- Qualifications Section -->
                                             <div>
                                                  <h3 class="text-lg font-semibold text-gray-900 mb-4">Qualifications</h3>
                                                  <div class="space-y-4">
                                                       <% user.qualifications.forEach(qual=> { %>
                                                            <div class="bg-gray-50 rounded-lg p-4">
                                                                 <div class="flex items-start gap-4">
                                                                      <div class="w-12 h-12 rounded-full bg-purple-100 flex items-center justify-center">
                                                                           <i class="fas fa-graduation-cap text-purple-600"></i>
                                                                      </div>
                                                                      <div>
                                                                           <h4 class="font-medium text-gray-900">
                                                                                <%= qual.title %>
                                                                           </h4>
                                                                           <p class="text-gray-600">
                                                                                <%= qual.institution %> • <%= qual.year %>
                                                                           </p>
                                                                      </div>
                                                                 </div>
                                                            </div>
                                                            <% }) %>
                                                  </div>
                                             </div>
                                        </div>
                                   </div>
                              </div>
                         </div>
                    </div>
               </div>

               <!-- Gallery Modal Template -->
               <template id="gallery-modal">
                    <div class="fixed inset-0 z-50 overflow-hidden" role="dialog" aria-modal="true">
                         <div class="absolute inset-0 bg-black/90 backdrop-blur-sm"></div>
                         <div class="relative flex items-center justify-center min-h-screen p-4">
                              <div class="relative max-w-7xl w-full">
                                   <img src="" alt="Gallery image" class="max-h-[85vh] mx-auto object-contain">
                                   <button onclick="closeGalleryModal()" class="absolute top-4 right-4 w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 
                               flex items-center justify-center transition-colors">
                                        <i class="fas fa-times text-white"></i>
                                   </button>
                              </div>
                         </div>
                    </div>
               </template>

               <!-- Styles -->
               <style>
                    /* Hide scrollbar while allowing scrolling */
                    .no-scrollbar {
                         -ms-overflow-style: none;
                         scrollbar-width: none;
                    }

                    .no-scrollbar::-webkit-scrollbar {
                         display: none;
                    }

                    /* Line clamp for multi-line text truncation */
                    .line-clamp-2 {
                         display: -webkit-box;
                         -webkit-line-clamp: 2;
                         -webkit-box-orient: vertical;
                         overflow: hidden;
                    }

                    /* Animations */
                    @keyframes fadeIn {
                         from {
                              opacity: 0;
                              transform: scale(0.95);
                         }

                         to {
                              opacity: 1;
                              transform: scale(1);
                         }
                    }

                    @keyframes fadeOut {
                         from {
                              opacity: 1;
                              transform: scale(1);
                         }

                         to {
                              opacity: 0;
                              transform: scale(0.95);
                         }
                    }

                    .animate-fade-in {
                         animation: fadeIn 0.2s ease-out forwards;
                    }

                    .animate-fade-out {
                         animation: fadeOut 0.2s ease-out forwards;
                    }

                    /* Fix for iOS safari notch */
                    @supports (padding-top: env(safe-area-inset-top)) {
                         .pt-safe {
                              padding-top: env(safe-area-inset-top);
                         }
                    }
               </style>

               <!-- Scripts -->
               <script>
                    // Gallery Modal Functionality
                    function initGalleryModal() {
                         const template = document.getElementById('gallery-modal');
                         let modalInstance = null;

                         window.openGalleryModal = function (imageSrc) {
                              if (!modalInstance) {
                                   modalInstance = template.content.cloneNode(true);
                                   document.body.appendChild(modalInstance);
                              }

                              const modal = document.querySelector('[role="dialog"]');
                              const modalImg = modal.querySelector('img');
                              modalImg.src = imageSrc;

                              modal.classList.add('animate-fade-in');
                              document.body.classList.add('overflow-hidden');

                              modal.addEventListener('click', (e) => {
                                   if (e.target === modal) {
                                        closeGalleryModal();
                                   }
                              });

                              document.addEventListener('keydown', (e) => {
                                   if (e.key === 'Escape') {
                                        closeGalleryModal();
                                   }
                              });
                         };

                         window.closeGalleryModal = function () {
                              const modal = document.querySelector('[role="dialog"]');
                              if (modal) {
                                   modal.classList.add('animate-fade-out');
                                   setTimeout(() => {
                                        modal.remove();
                                        document.body.classList.remove('overflow-hidden');
                                   }, 200);
                              }
                         };
                    }

                    // Initialize functionality
                    document.addEventListener('DOMContentLoaded', () => {
                         initGalleryModal();

                         // Initialize Alpine.js data
                         Alpine.data('profileTabs', () => ({
                              activeTab: 'services',
                              loading: false,

                              init() {
                                   const hash = window.location.hash.slice(1);
                                   if (['services', 'reviews', 'gallery', 'about'].includes(hash)) {
                                        this.activeTab = hash;
                                   }

                                   this.$watch('activeTab', (value) => {
                                        window.location.hash = value;
                                   });
                              }
                         }));
                    });
               </script>