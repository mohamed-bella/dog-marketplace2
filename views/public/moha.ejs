<%- include('../marketplace/partials/head.ejs') %>
     <%- include('../marketplace/partials/navbar.ejs') %>

          <style>
               body {
                    font-family: 'Readex Pro', sans-serif;
                    background-color: aliceblue;
               }

               .kefta-container {
                    max-width: 600px;
                    font-family: 'Readex Pro', sans-serif;
                    margin: auto;
                    padding: 20px;
                    background: white;
                    border-radius: 12px;
                    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
               }

               i.bi {
                    font-size: 30px;
               }

               img {
                    border-radius: 50%;
                    width: 150px;
                    margin-bottom: 20px;
               }

               h2 {
                    font-family: 'Cairo', sans-serif;
                    color: #333;
               }

               .form-label {
                    font-family: 'Cairo', sans-serif;
                    font-weight: 600;
               }

               .btn-outline-secondary,
               .btn-outline-primary {
                    border-radius: 12px;
                    transition: all 0.3s ease;
               }

               .btn-outline-secondary:hover,
               .btn-outline-primary:hover {
                    background-color: #eee;
                    transform: scale(1.02);
               }

               .input-group {
                    margin-bottom: 20px;
               }

               input[type="tel"] {
                    padding: 10px;
                    border: 1px solid #ccc;
                    border-radius: 8px;
                    font-size: 16px;
               }

               .btn-success {
                    padding: 10px 15px;
                    border-radius: 10px;
                    font-size: 18px;
                    font-weight: bold;
                    transition: all 0.3s ease;
               }

               .btn-success:hover {
                    background-color: #28a745;
                    transform: scale(1.02);
               }

               .price-info {
                    font-size: 22px;
                    font-weight: bold;
                    color: #333;
                    padding-top: 10px;
               }

               .city-card {
                    border: 1px solid #ccc;
                    border-radius: 10px;
                    padding: 20px;
                    text-align: center;
                    cursor: pointer;
                    transition: all 0.3s ease;
               }

               .city-card:hover {
                    background-color: #f9f9f9;
                    transform: scale(1.05);
               }

               .active-city {
                    border: 2px solid #007bff !important;
               }

               .modal-content {
                    border-radius: 12px;
               }

               /* Custom number input styles */
               .number-input {
                    width: 100%;
                    background: rgb(249, 207, 0);
                    border-radius: 10mm;
                    box-sizing: border-box;
                    padding: 10px;
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    font-family: 'Cairo', sans-serif;
                    transform-style: preserve-3d;
                    box-shadow: rgba(0, 0, 0, 0.02) 0px 1px 3px 0px, rgba(27, 31, 35, 0.15) 0px 0px 0px 1px;
                    transition: 0.25s;
               }

               .btn-num {
                    width: 50px;
                    height: 50px;
                    border-radius: 50%;
                    background: white;
                    color: black;
                    outline: none;
                    border: none;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    cursor: pointer;
                    position: relative;
               }

               .btn-num span {
                    font-size: 32px;
               }

               .value {
                    flex-grow: 1;
                    display: flex;
                    height: 100%;
                    align-items: center;
                    justify-content: center;
                    flex-direction: column;
               }

               .number {
                    flex-grow: 1;
                    display: flex;
                    align-items: flex-end;
                    justify-content: center;
                    font-size: 36px;
                    font-weight: 600;
               }

               .text {
                    font-size: 16px;
                    font-weight: 500;
                    letter-spacing: 1px;
               }
          </style>

          <div class="kefta-container text-center mt-5">
               <!-- Logo at the top -->
               <img src="https://yt3.googleusercontent.com/bOVT7EPOgmVJQX_9nB1J4jGgP-eg4RsZcSZTlzOcCrNeNZKImd_zrMqtug2QBiYMPTLtRose=s900-c-k-c0x00ffffff-no-rj" alt="Moha Chnider Kefta">
               <h2 class="mb-4">كفتة موحا شنايدر</h2>

               <form id="keftaForm" novalidate>
                    <!-- Custom Quantity Input -->
                    <div class="mb-4">
                         <label for="quantity" class="form-label fw-bold">الكمية (بالكيلوغرام)</label>
                         <div class="number-input" min="10" step="1" value="10">
                              <button type="button" class="btn-num" onclick="decrease()">
                                   <i class="bi bi-dash"></i> </button>
                              <div class="value">
                                   <span class="number">10</span>
                                   <span class="text">كيلوغرام</span>
                              </div>
                              <button type="button" class="btn-num" onclick="increase()">
                                   <i class="bi bi-plus"></i>
                              </button>
                         </div>
                         <small class="form-text text-muted">الحد الأدنى للطلب هو 10 كيلوغرام.</small>
                    </div>

                    <!-- City Selection -->
                    <div class="mb-4">
                         <label class="form-label fw-bold">اختر مدينتك</label>
                         <div class="row">
                              <!-- Casablanca Card -->
                              <div class="col-6">
                                   <input type="radio" class="btn-check" name="city" id="casablanca" value="Casablanca" autocomplete="off" checked required>
                                   <label class="btn btn-outline-secondary w-100 city-card" for="casablanca">
                                        <img src="https://img.icons8.com/?size=100&id=53426&format=png&color=FAB005" alt="Casablanca" class="img-fluid mb-2">
                                        <br> الدار البيضاء
                                   </label>
                              </div>
                              <!-- Other Cities Card -->
                              <div class="col-6">
                                   <input type="radio" class="btn-check" name="city" id="autre" value="Autre" autocomplete="off" required>
                                   <label class="btn btn-outline-secondary w-100 city-card" for="autre">
                                        <img src="https://img.icons8.com/?size=100&id=U2rfVevdGDVK&format=png&color=000000" alt="Autre Ville" class="img-fluid mb-2">
                                        <br> مدينة مغربية أخرى
                                   </label>
                              </div>
                         </div>
                    </div>

                    <!-- Phone Number -->
                    <div class="mb-4">
                         <label for="phone" class="form-label fw-bold">رقم الهاتف</label>
                         <input type="tel" id="phone" name="phone" class="form-control" placeholder="أدخل رقم هاتفك" required>
                    </div>

                    <!-- Display the total price -->
                    <div class="price-info">
                         <h4>المجموع: <span id="totalPrice">170 درهم</span></h4>
                    </div>

                    <!-- Confirm Button -->
                    <button type="button" id="confirmButton" class="btn btn-warning w-100" data-bs-toggle="modal" data-bs-target="#orderModal">تأكيد الطلب</button>
               </form>
          </div>

          <!-- Modal for showing order confirmation -->
          <div class="modal fade" id="orderModal" tabindex="-1" aria-labelledby="orderModalLabel" aria-hidden="true">
               <div class="modal-dialog">
                    <div class="modal-content">
                         <div class="modal-header">
                              <h5 class="modal-title" id="orderModalLabel">تأكيد طلبك</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                         </div>
                         <div class="modal-body">
                              <p><strong>الكمية:</strong> <span id="modalQuantity">10kg</span></p>
                              <p><strong>المدينة:</strong> <span id="modalCity">الدار البيضاء</span></p>
                              <p><strong>رقم الهاتف:</strong> <span id="modalPhone">0000000000</span></p>
                              <p><strong>المجموع:</strong> <span id="modalTotalPrice">170 درهم</span></p>
                         </div>
                         <div class="modal-footer">
                              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">تعديل</button>
                              <a href="#" id="whatsappButton" target="_blank" class="btn btn-success">طلب عبر الواتساب</a>
                         </div>
                    </div>
               </div>
          </div>

          <script>
               const keftaPricePerKg = 15;
               const deliveryCasablanca = 20;
               const deliveryOtherCities = 50;

               let quantityValue = 10; // Default quantity
               const quantityInput = document.querySelector(".number-input");
               const cityInputs = document.querySelectorAll('input[name="city"]');
               const totalPriceElement = document.getElementById('totalPrice');
               const confirmButton = document.getElementById('confirmButton');
               const whatsappButton = document.getElementById('whatsappButton');

               const modalQuantity = document.getElementById('modalQuantity');
               const modalCity = document.getElementById('modalCity');
               const modalPhone = document.getElementById('modalPhone');
               const modalTotalPrice = document.getElementById('modalTotalPrice');

               // Function to calculate and display total price
               function calculateTotalPrice() {
                    const city = document.querySelector('input[name="city"]:checked').value;
                    const deliveryCost = city === 'Casablanca' ? deliveryCasablanca : deliveryOtherCities;

                    // Calculate total price
                    const totalPrice = (quantityValue * keftaPricePerKg) + deliveryCost;

                    // Update the price in the UI
                    totalPriceElement.textContent = totalPrice + ' درهم';
               }

               // Function to increase quantity
               function increase() {
                    quantityValue++;
                    document.querySelector('.number').textContent = quantityValue;
                    calculateTotalPrice();
               }

               // Function to decrease quantity
               function decrease() {
                    if (quantityValue > 10) {
                         quantityValue--;
                         document.querySelector('.number').textContent = quantityValue;
                         calculateTotalPrice();
                    }
               }

               // Event listeners for real-time price update
               cityInputs.forEach(input => {
                    input.addEventListener('change', calculateTotalPrice);
               });

               // When user clicks confirm button, show modal with order info
               confirmButton.addEventListener('click', function () {
                    const city = document.querySelector('input[name="city"]:checked').value;
                    const phone = document.getElementById('phone').value;
                    const totalPrice = totalPriceElement.textContent;

                    // Validate phone and quantity
                    if (phone.trim() === '' || quantityValue < 10) {
                         alert('يرجى إدخال كمية صالحة ورقم هاتف.');
                         return;
                    }

                    // Update modal content with order details
                    modalQuantity.textContent = quantityValue + 'kg';
                    modalCity.textContent = city;
                    modalPhone.textContent = phone;
                    modalTotalPrice.textContent = totalPrice;

                    // Prepare WhatsApp URL with order details
                    const message = `مرحبًا، أود طلب ${quantityValue}kg من الكفتة. مدينتي هي ${city}. المجموع الكلي هو ${totalPrice}. رقم هاتفي هو ${phone}.`;
                    const whatsappUrl = `https://wa.me/+212668712726?text=${encodeURIComponent(message)}`;

                    // Set the WhatsApp button URL
                    whatsappButton.href = whatsappUrl;
               });
          </script>

          <%- include('../marketplace/partials/footer.ejs') %>